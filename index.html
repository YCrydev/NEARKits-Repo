<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta content="width=device-width, initial-scale=1.0" name="viewport" />
      <title>NEAR Kits</title>
      <meta name="description" content="NERAKits, Nft Portfolio manager!" />
      <meta name="image" content="https://nearkits.io/assets/images/logo-mini-white.png" />
      <meta content="NERAKits, Nft Portfolio manager!" name="keywords" />
      <meta name="author" content="Near-Kits" />
      <meta property="og:type" content="website" />
      <meta property="og:title" content="Near-Kits" />
      <meta property="og:description" content="NERAKits, Nft Portfolio manager!" />
      <meta property="og:image" content="https://nearkits.io/assets/images/logo-mini-white.png" />
      <meta property="twitter:card" content="summary_large_image" />
      <meta property="twitter:url" content="" />
      <meta property="twitter:title" content="Near-Kits" />
      <meta property="twitter:description" content="NERAKits, Nft Portfolio manager!" />
      <meta property="twitter:image" content="https://nearkits.io/assets/images/logo-mini-white.png" />
      <!-- Favicons -->
      <link href="https://nearkits.io/assets/images/logo-mini-black.png" rel="icon" />
      <!--<link href="assets/https://nearkits.io/assets/images/apple-touch-icon.png" rel="apple-touch-icon">-->
      <!-- Favicons -->
      <link href="https://nearkits.io/assets/images/logo-mini-white.png" rel="icon" />
      <!-- plugins:css -->
      <link rel="stylesheet" href="assets/vendors/mdi/css/materialdesignicons.min.css" />
      <link rel="stylesheet" href="assets/vendors/css/vendor.bundle.base.css" />
      <!-- endinject -->
      <!-- Plugin css for this page -->
      <link rel="stylesheet" href="assets/vendors/jvectormap/jquery-jvectormap.css" />
      <link rel="stylesheet" href="assets/vendors/flag-icon-css/css/flag-icon.min.css" />
      <link rel="stylesheet" href="assets/vendors/owl-carousel-2/owl.carousel.min.css" />
      <link rel="stylesheet" href="assets/vendors/owl-carousel-2/owl.theme.default.min.css" />
      <link rel="stylesheet" href="assets/css/pagination.css" />
      <!-- End plugin css for this page -->
      <!-- inject:css -->
      <!-- endinject -->
      <!-- Layout styles -->
      <link rel="stylesheet" href="assets/css/style-new.css" />
      <!-- End layout styles -->
      <link rel="shortcut icon" href="https://nearkits.io/assets/images/logo-mini-white.png" />
      <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css" rel="stylesheet" />
      <link rel="stylesheet" href="assets/css/datatables.min.css" />
      <link rel="stylesheet" href="assets/css/responsive.dataTables.min.css" />
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
      <!-- Global site tag (gtag.js) - Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-V8QFHPSX64"></script>
      <script>
         window.dataLayer = window.dataLayer || [];
         function gtag() {
            dataLayer.push(arguments);
         }
         gtag("js", new Date());
         
         gtag("config", "G-V8QFHPSX64");
      </script>
      <style>
         .dtr-modal-content{
         background-color: black;
         }
         div.dtr-modal div.dtr-modal-display {
         background-color: black!important;
         border: 1px solid white!important;
         }
         table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>td:first-child:before, table.dataTable.dtr-inline.collapsed>tbody>tr[role="row"]>th:first-child:before {
         margin-top: 3px;
         background-color: black!important;
         }
         table.dataTable td, table.dataTable th {
         -webkit-box-sizing: content-box;
         box-sizing: content-box;
         background: black;
         color: white;
         }
         div.dtr-modal div.dtr-modal-close {
         width: 27px;
         height: 27px;
         color:black;
         }
         .sidebar.light {
         transition-timing-function: ease-in;
         background: #F1F0F0;
         }
         select.light{
         border: 1px solid #2c2e33;
         background-color: #2A3038;
         border-radius: 2px;
         }
         .content-wrapper.light{
         transition-timing-function: ease-in;
         background: #F5F5F5;
         }
         .navbar.light {
         transition-timing-function: ease-in;
         font-weight: normal;
         background: white;
         }
         .navbar .navbar-menu-wrapper .search input.light {
         transition-timing-function: ease-in;
         background: white;
         }
         .navbar .navbar-brand-wrapper.light{
         transition-timing-function: ease-in;
         background: white;
         }
         .card.light {
         border-color: #C2C2C2;
         transition-timing-function: ease-in;
         background-color: white;
         }
         .nav-link.light:hover, .nav-link.light:focus {
         background: white!important;
         }
         .sidebar .nav .nav-item.active > .nav-link.light {
         transition-timing-function: ease-in;
         background: white;
         }
         .sidebar .nav:not(.sub-menu) > .nav-item:hover:not(.nav-category):not(.account-dropdown) > .nav-link.light {
         transition-timing-function: ease-in;
         background: white;
         }
         .sidebar .sidebar-brand-wrapper.light {
         transition-timing-function: ease-in;
         background: #e3e3e3;
         }
         .form-control.light{
         transition-timing-function: ease-in;
         background: white;
         }
         .footer.light {
         transition-timing-function: ease-in;
         background: white;
         }
         .sidebar .nav .nav-item.active > .nav-link.light {
         transition-timing-function: ease-in;
         background: white;
         }
         .sidebar .nav .nav-item .menu-icon i {
         font-size: 1.09rem; 
         }
         .navbar .navbar-menu-wrapper .navbar-nav .nav-item.dropdown .dropdown-menu.navbar-dropdown .dropdown-item.light {
         background: #F1F0F0;
         }
         .modal-content.light {
         background-color: white;
         }
         .dropdown-divider.light {
         border-top: 1px solid white;
         }
         .profile_div.light{
         background: white;
         }
         .message_div{
         background: #191c24;
         padding: 2rem;
         border-radius: 10px;
         }
         .message_div.light{
         background: white;
         }
         /* The switch - the box around the slider */
         .switch {
         position: relative;
         display: inline-block;
         width: 30px;
         height: 17px;
         }
         /* Hide default HTML checkbox */
         .switch input {
         opacity: 0;
         width: 0;
         height: 0;
         }
         /* The slider */
         .slider {
         position: absolute;
         cursor: pointer;
         top: 0;
         left: 0;
         right: 0;
         bottom: 0;
         background-color: #ccc;
         -webkit-transition: .4s;
         transition: .4s;
         }
         .slider:before {
         position: absolute;
         content: "";
         height: 13px;
         width: 13px;
         left: 2px;
         bottom: 2px;
         background-color: white;
         -webkit-transition: .4s;
         transition: .4s;
         }
         input:checked + .slider {
         background-color: #000000;
         }
         input:focus + .slider {
         box-shadow: 0 0 1px #2196F3;
         }
         input:checked + .slider:before {
         -webkit-transform: translateX(13px);
         -ms-transform: translateX(13px);
         transform: translateX(13px);
         }
         /* Rounded sliders */
         .slider.round {
         border-radius: 17px;
         }
         .slider.round:before {
         border-radius: 50%;
         }
         @media only screen and (min-width: 992px) {
         .sidebar {
         position: fixed;
         height: 100%;
         margin-right: 244px;
         }
         .page-body-wrapper {
         margin-left: 244px;
         }
         .sidebar {
         border-right: 2px solid #8f5fe8;
         }
         .sidebar.light {
         border-right: 2px solid white;
         }
         }
         .image_message{
         border-radius: 15px;
         background-repeat: no-repeat;
         background-size: 100% 100%;
         aspect-ratio: 1/1;
         height: 300px;
         font-size:14px;
         text-align:center;
         padding: 0.3rem 2rem;
         }
         #nft_message{
         color: black;
         word-break: break-word;
         }
         #message_alert_count{
         margin-left: 0.5rem;
         font-size: 0.5125rem;
         line-height: 1;
         width: 21px;
         height: 21px;
         border-radius: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         color: #ffffff;
         }
         .message_card{
         border:0px !important;
         background-color:#191c2400!important;
         }
         .red_alert{
         margin-left: 0.4rem;
         margin-right: 0.1rem;
         width: 5px;
         height: 5px;
         border-radius: 100%;
         align-items: center;
         justify-content: center;
         color: #ffffff;
         }
         .search_bar{
         border-top-left-radius: 10px;
         border-bottom-left-radius: 10px;
         height:38px;
         font-weight: normal;
         font-size: 0.875rem;
         padding: 0.625rem 0.6875rem;
         position: relative;
         flex: 1 1 auto;
         width: 1%;
         min-width: 0;
         background
         }
         .search_bar.light{
         border: 1px solid black !important;
         background:white;
         }
         .search_bar{
         border: 1px solid black !important;
         background:#101115;
         }
         .card{
         border-radius: 10px !important;
         }
         .search_bar_icon{
         border-top-right-radius: 10px;
         border-bottom-right-radius: 10px;
         height:38px;
         border: 1px solid black !important;
         }
         .border-rounded{
         border-radius: 10px;
         }
         select{
         border-radius: 10px!important;
         }
         .btn-padding{
         padding: 0.5rem 1rem;
         }
         .card-footer {
         padding: 0.5rem 1rem;
         /* background-color: rgba(0, 0, 0, 0.03); */
         /* border-top: 1px solid rgba(0, 0, 0, 0.125); */
         }
         .sidebar .nav .nav-item .menu-icon {
         margin-right: 0.5rem;
         /* font-size: 10px; */
         /* line-height: 1; */
         background: rgba(108, 114, 147, 0.0);
         width: 31px;
         height: 31px;
         border-radius: 100%;
         display: flex;
         align-items: center;
         justify-content: center;
         color: #ffffff;
         }
         .toggle {
         position: relative;
         display: block;
         width: 50px;
         height: 30px;
         cursor: pointer;
         -webkit-tap-highlight-color: transparent;
         -webkit-transform: translate3d(0, 0, 0);
         transform: translate3d(0, 0, 0); }
         .toggle:before {
         content: "";
         text-align: right;
         position: relative;
         top: 3px;
         left: 3px;
         width: 50px;
         height: 22px;
         font-size: 10px;
         display: block;
         background: #e6e6e6;
         border-radius: 30px;
         -webkit-transition: background .2s ease;
         -o-transition: background .2s ease;
         transition: background .2s ease;
         padding: 2px 8px; }
         .toggle span {
         position: absolute;
         top: 2px;
         left: 0;
         width: 24px;
         height: 24px;
         display: block;
         background: #fff;
         border-radius: 50%;
         -webkit-box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
         box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
         -webkit-transition: all .2s ease;
         -o-transition: all .2s ease;
         transition: all .2s ease; }
         .toggle span:before {
         font-family: 'Fontawesome';
         content: '\f185';
         position: absolute;
         display: block;
         margin: 0;
         width: 24px;
         height: 24px;
         background: white;
         border-radius: 50%;
         -webkit-transform: scale(1);
         -ms-transform: scale(1);
         transform: scale(1);
         opacity: 1;
         pointer-events: none;
         color: black;
         padding: 4px;}
         #switch_mode_cbx:checked + .toggle:before,
         #cbx2:checked + .toggle:before {
         background: #000;
         content: '';
         text-align: left;
         color: #fff; }
         #switch_mode_cbx:checked + .toggle span,
         #cbx2:checked + .toggle span {
         background: #f1bc31;
         -webkit-transform: translateX(31px);
         -ms-transform: translateX(31px);
         transform: translateX(31px);
         -webkit-transition: all 0.2s cubic-bezier(0.8, 0.4, 0.3, 1.25), background 0.15s ease;
         -o-transition: all 0.2s cubic-bezier(0.8, 0.4, 0.3, 1.25), background 0.15s ease;
         transition: all 0.2s cubic-bezier(0.8, 0.4, 0.3, 1.25), background 0.15s ease;
         }
         #switch_mode_cbx:checked + .toggle span:before,
         #cbx2:checked + .toggle span:before {
         -webkit-transform: scale(1);
         -ms-transform: scale(1);
         transform: scale(1);
         opacity: 1;
         -webkit-transition: all .4s ease;
         -o-transition: all .4s ease;
         transition: all .4s ease;
         font-family: 'Fontawesome';
         content: '\f186';
         background: #000;
         color: white;
         padding: 4px;}
         .vertical_center_container {
         height:320px;
         position: relative;
         }
         .vertical_center {
         margin: 0;
         position: absolute;
         top: 50%;
         left: 50%;
         -ms-transform: translate(-50%, -50%);
         transform: translate(-50%, -50%);
         }
         .theme-dark-bg{
         background: #101115;
         }
         .theme-white-bg{
         background: #f8f8f8;
         }
         .border-selected{
         border-color: #0090e7 !important;
         border: 2px solid #0090e7 !important;
         }
         .border-selected-red{
         border-color: #fc424a !important;
         border: 2px solid #fc424a !important;
         }
         .card-img-top{
         border-top-right-radius: 10px;
         border-top-left-radius: 10px;
         }
         .bg-pagination.light{
         background:white;
         }
         .bg-pagination{
         background-color: #191c24;
         }
         .close_modal{
         cursor:pointer;
         }
         .dropdown-menu {
         border-radius: 10px;
         background-color: transparent;
         }
         .btn-outline-dark{
         color:white!important;
         }
         .btn-outline-dark.light{
         color:black!important;
         }
         .btn-outline-dark.light:hover{
         color:white!important;
         }
         /*.image_listed{*/
         /*  height:200px;  */
         /*  width:200px;  */
         /*}*/
         @media (min-width: 767.98px) {
         .mat_top{
         margin-top: 50%;
         }
         }
         .btn_switch.light{
         background:#f8f8f8!important;
         color:black!important;
         }
      </style>
   </head>
   <body>
      <div class="container-scroller">
         <!-- partial:partials/_sidebar.html -->
         <nav class="sidebar switch_theme sidebar-offcanvas" id="sidebar">
            <div class="sidebar-brand-wrapper switch_theme d-none d-lg-flex align-items-center justify-content-center fixed-top">
               <a class="sidebar-brand brand-logo" href="index.html"><img src="https://nearkits.io/assets/images/logo-new-tp-white.png" class="brand-logo-img" alt="logo" style="height: 100%;" /></a>
               <a class="sidebar-brand brand-logo-mini" href="index.html"><img src="https://nearkits.io/assets/images/logo-mini-white.png" class="brand-logo-mini-img" alt="logo" /></a>
            </div>
            <ul class="nav">
               <li class="nav-item nav-category">
                  <span class="nav-link">Navigation</span>
               </li>
               <div class="px-2 account_address d-none">
                  <div class="input-group mb-2 mr-sm-2">
                     <input type="text" class="switch_theme search_bar text-dark" id="copy_address" placeholder="Address" value="" disabled>
                     <div class="input-group-prepend">
                        <button class="input-group-text search_bar_icon" onclick="copyAddress()"><i class="mdi mdi-content-copy text-muted"></i></button>
                     </div>
                  </div>
               </div>
               <li class="nav-item menu-items active nav_select" id="dashboard_nav">
                  <a class="nav-link switch_theme light" href="#">
                  <span class="menu-icon">
                  <i class="mdi mdi-speedometer"></i>
                  </span>
                  <span class="menu-title text-white">Dashboard</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="my_nfts_nav">
                  <a class="nav-link switch_theme light" href="#my_nfts">
                  <span class="menu-icon">
                  <i class="mdi mdi-animation"></i>
                  </span>
                  <span class="menu-title text-white">My NFTs</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="batch_offer_nav">
                  <a class="nav-link switch_theme light" href="#batch_offer">
                  <span class="menu-icon">
                  <i class="mdi mdi-apps"></i>
                  </span>
                  <span class="menu-title text-white">Batch offer</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="batch_list_nav">
                  <a class="nav-link switch_theme light" href="#batch_list">
                  <span class="menu-icon">
                  <i class="mdi mdi-format-list-checkbox"></i>
                  </span>
                  <span class="menu-title text-white">Batch List</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="send_nft_message_nav">
                  <a class="nav-link switch_theme light" href="#send_nft_message">
                  <span class="menu-icon">
                  <i class="mdi mdi-message"></i>
                  </span>
                  <span class="menu-title text-white">Send Message</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="manage_messages_nav">
                  <a class="nav-link switch_theme light" href="#manage_messages">
                     <span class="menu-icon">
                     <i class="mdi mdi-forum"></i>
                     </span>
                     <span class="menu-title text-white">Manage Messages </span>
                     <div id="message_alert_count" class="bg-danger d-none" style=""></div>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="gallery_select_nav">
                  <a class="nav-link switch_theme light" href="#gallery_select">
                  <span class="menu-icon">
                  <i class="mdi mdi-view-quilt"></i>
                  </span>
                  <span class="menu-title text-white">Select Theme </span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="transaction_history_nav">
                  <a class="nav-link switch_theme light" href="#transaction_history">
                  <span class="menu-icon">
                  <i class="mdi mdi-ballot-recount-outline"></i>
                  </span>
                  <span class="menu-title text-white">Transaction History </span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="snipe_nav">
                  <a class="nav-link switch_theme light" href="#snipe">
                  <span class="menu-icon">
                  <i class="mdi mdi-book-search"></i>
                  </span>
                  <span class="menu-title text-white">Snipe</span>
                  </a>
               </li>
               <li class="nav-item menu-items nav_select" id="whale_tracker_nav">
                  <a class="nav-link switch_theme light" href="#whale_tracker">
                  <span class="menu-icon">
                  <i class="mdi mdi-docker"></i>
                  </span>
                  <span class="menu-title text-white">Whale Tracker</span>
                  </a>
               </li>
            </ul>
         </nav>
         <!-- partial -->
         <div class="container-fluid page-body-wrapper">
            <!-- partial:partials/_navbar.html -->
            <nav class="navbar switch_theme p-0 fixed-top d-flex flex-row">
               <div class="navbar-brand-wrapper switch_theme d-flex d-lg-none align-items-center justify-content-center">
                  <a class="navbar-brand brand-logo-mini text-dark" href="index.html"><img class="img-fluid brand-logo-mini-img" src="assets/images/logo-mini-white.png" style="width: 35px; height: 35px;" /></a>
               </div>
               <div class="navbar-menu-wrapper switch_theme flex-grow d-flex align-items-stretch">
                  <ul class="navbar-nav w-100"></ul>
                  <ul class="navbar-nav navbar-nav-right">
                     <li class="nav-item dropdown">
                        <a class="nav-link" id="profileDropdown" href="#">
                           <div class="navbar-profile">
                              <button class="btn-sm btn-primary border-rounded wallet_sign" id="Wallet"></button>
                              <p class="mb-0 d-none d-sm-block navbar-profile-name"></p>
                              <i class="mdi mdi-menu-down d-none d-sm-block"></i>
                              <!--<i class="mdi mdi-weather-sunny-alert ms-1 d-flex my-auto" ></i>-->
                              <div class="w-100 d-flex justify-content-center">
                                 <div class="checkbox ms-2">
                                    <input type="checkbox" id="switch_mode_cbx" style="display: none;" />
                                    <label for="switch_mode_cbx" class="toggle"><span></span></label>
                                 </div>
                              </div>
                              <label class="switch d-none">
                              <input type="checkbox" checked id="switch_mode" />
                              <span class="slider round"></span>
                              </label>
                              <!--<i class="mdi mdi-moon-waning-crescent ms-1 d-flex my-auto" ></i>-->
                           </div>
                        </a>
                        <div class="dropdown-menu logout_drop theme-white-bg dropdown-menu-right navbar-dropdown preview-list dropdown_profile border-rounded d-none" aria-labelledby="profileDropdown" style="width: 50px;">
                           <div class="dropdown-divider switch_theme"></div>
                           <div class="dropdown-divider switch_theme"></div>
                           <a class="dropdown-item preview-item border-rounded switch_theme">
                              <div class="preview-thumbnail">
                                 <div class="preview-icon theme-white-bg rounded-circle">
                                    <i class="mdi mdi-logout text-danger"></i>
                                 </div>
                              </div>
                              <div class="preview-item-content" id="logout">
                                 <p class="preview-subject text-white mb-1">Log out</p>
                              </div>
                           </a>
                        </div>
                     </li>
                  </ul>
                  <button class="navbar-toggler navbar-toggler-right d-lg-none align-self-center" type="button" data-toggle="offcanvas">
                  <span class="mdi mdi-format-line-spacing"></span>
                  </button>
               </div>
            </nav>
            <!-- partial -->
            <div class="main-panel">
               <div class="content-wrapper switch_theme">
                  <div id="dashboard_display" class="display_panel">
                     <form class="search_account_form">
                        <div class="input-group mb-2">
                           <input type="text" class="switch_theme search_bar text-dark" id="search_account" placeholder="Near Account" />
                           <div class="input-group-prepend">
                              <button class="input-group-text search_account_btn search_bar_icon" type="submit" style="cursor: pointer;"><i class="mdi mdi-magnify text-muted"></i></button>
                           </div>
                        </div>
                     </form>
                     <center>
                        <div class="vertical-center">
                           <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                              <div class="progress-bar" style="width: 10%; display: none;"></div>
                           </div>
                        </div>
                     </center>
                     <div class="row d-none" id="display_account_info">
                        <input id="account_floor" type="hidden" />
                        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-block align-items-center align-self-start">
                                          <h6 class="text-muted font-weight-normal">Total Account Value</h6>
                                          <div class="theme-white-bg border-rounded p-3">
                                             <h5 id="total_value" class="mb-0 reload_divs text-dark">
                                                <img class="col align-self-center img-fluid" style="height: 60px; width: 60px;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                                             </h5>
                                             <div class="text-dark ml-auto mt-2 font-weight-medium usd_show" id="usd_near_total"></div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="d-flex justify-content-end"></div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-block align-items-center align-self-start">
                                          <h6 class="text-muted font-weight-normal">Total Floor Price</h6>
                                          <div class="theme-white-bg border-rounded p-3">
                                             <h5 id="total_floor" class="mb-0 reload_divs text-dark">
                                                <img class="col align-self-center img-fluid" style="height: 60px; width: 60px;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                                             </h5>
                                             <div class="text-dark ml-auto mt-2 font-weight-medium usd_show" id="usd_near_floor"></div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-block align-items-center align-self-start">
                                          <h6 class="text-muted font-weight-normal">Liquid Near</h6>
                                          <div class="theme-white-bg border-rounded p-3">
                                             <h5 id="liquid_near" class="mb-0 reload_divs text-dark">
                                                <img class="col align-self-center img-fluid" style="height: 60px; width: 60px;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                                             </h5>
                                             <div class="text-dark ml-auto mt-2 font-weight-medium usd_show" id="usd_near_liquid"></div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-xl-3 col-sm-6 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-block align-items-center align-self-start">
                                          <h6 class="text-muted font-weight-normal">Validator Staked Near</h6>
                                          <div class="theme-white-bg border-rounded p-3">
                                             <h5 id="staked_near" class="mb-0 reload_divs text-dark">
                                                <img class="col align-self-center img-fluid" style="height: 60px; width: 60px;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                                             </h5>
                                             <div class="text-dark ml-auto mt-2 font-weight-medium usd_show" id="usd_near_staked"></div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <p class="text-dark">
                        Displaying <span id="nfts_count"></span> out of <span id="total_nft_count"></span>
                        <label class="ms-auto d-block loading_array"> updating... <img class="col align-self-center img-fluid" style="height: 20px; width: 20px;" src="https://nearkits.io/assets/images/loading_circle.svg" /></label>
                     </p>
                     <div id="normal_nfts" class="row d-none">
                        <div class="form-group ms-auto col-5">
                           <label for="sort_filter_normal">Display No</label>
                           <select class="form-control switch_theme text-white" id="sort_filter_normal">
                              <option value="10">10</option>
                              <option value="25">25</option>
                              <option value="50">50</option>
                           </select>
                        </div>
                     </div>
                     <div id="stored_nfts" class="row">
                        <div class="form-group col-5">
                           <label for="sort_filter" class="text-white">Display No:</label>
                           <select class="form-control switch_theme text-white" id="sort_filter">
                              <option value="10">10</option>
                              <option value="25">25</option>
                              <option value="50">50</option>
                           </select>
                        </div>
                        <div class="form-group ms-auto col-5">
                           <label for="select_filter" class="text-white">Sort By:</label>
                           <select class="form-control switch_theme text-white" id="select_filter" disabled>
                              <option value="Alphabetically">Alphabetically (A -> Z)</option>
                              <option selected value="Highest">Highest to Lowest FP</option>
                              <option value="Lowest">Lowest to Highest FP</option>
                              <option value="RarityHigh">Highest to Lowest Rarity</option>
                              <option value="RarityLow">Lowest to Highest Rarity</option>
                              <option value="Staked">Staked</option>
                           </select>
                        </div>
                     </div>
                     <div class="row" id="display_nfts"></div>
                     <input type="hidden" id="totalPages" />
                     <div id="pagination" class="d-flex justify-content-center switch_theme bg-pagination p-2 border-rounded"></div>
                     <div class="row d-none" id="display_stored_nfts"></div>
                     <input type="hidden" id="totalPages" />
                     <div id="pagination_stored" class="d-flex justify-content-center switch_theme bg-pagination p-2 border-rounded"></div>
                  </div>
                  <div id="my_nfts_display" class="display_panel">
                     <div class="row">
                        <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-flex align-items-center align-self-start">
                                          <div class="col-12">
                                             <form class="search_nft_form">
                                                <div class="input-group mb-2">
                                                   <input type="text" class="switch_theme search_bar text-dark" id="search_nft_collection" placeholder="Search Nft collection" />
                                                   <div class="input-group-prepend">
                                                      <button class="input-group-text search_account_btn search_bar_icon" type="submit" style="cursor: pointer;"><i class="mdi mdi-magnify text-muted"></i></button>
                                                   </div>
                                                </div>
                                             </form>
                                             <a class="btn btn-dark border-rounded btn-padding me-2" data-toggle="modal" data-target="#batch_nft_transfer">Transfer</a>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-3">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div id="load_my_nfts"></div>
                     <div id="search_load_my_nfts" class="d-none"></div>
                  </div>
                  <div id="batch_offer_display" class="display_panel">
                     <div class="row">
                        <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-flex align-items-center align-self-start">
                                          <div class="col-12">
                                             <a class="btn btn-dark border-rounded btn-padding me-2 show_search_bids switch_theme">Place Bids</a>
                                             <a class="btn btn-outline-dark border-rounded btn-padding me-2 show_my_offers switch_theme">My Offers</a>
                                             <!--<a class="btn btn-dark border-rounded btn-padding me-2 test_ref">TEST</a>-->
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-3">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                        <div class="card switch_theme">
                           <div class="card-body">
                              <div class="bid_search_sub">
                                 <form class="search_collection_form">
                                    <div class="input-group mb-2">
                                       <input type="text" class="switch_theme search_bar text-dark" id="search_collection_paras" placeholder="Search Nft collection" />
                                       <div class="input-group-prepend">
                                          <button class="input-group-text search_account_btn search_bar_icon" type="submit" style="cursor: pointer;"><i class="mdi mdi-magnify text-muted"></i></button>
                                       </div>
                                    </div>
                                 </form>
                                 <a class="btn btn-dark border-rounded btn-padding me-2" data-toggle="modal" data-target="#batch_nft_bid">Bid</a>
                              </div>
                              <div class="my_offers_sub d-none">
                                 <h5 class="storage_used text-white"></h5>
                                 <a class="btn btn-danger border-rounded btn-padding me-2 cancel_offers">Close</a>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div id="load_search_collection" class="row bid_search_sub text-white">
                        <h5>Search Now!</h5>
                     </div>
                     <div id="load_my_offers" class="row my_offers_sub text-dark d-none"></div>
                  </div>
                  <div id="batch_list_display" class="display_panel">
                     <div class="row">
                        <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-flex align-items-center align-self-start">
                                          <div class="col-12">
                                             <a class="btn btn-dark border-rounded btn-padding me-2 show_unlisted_nfts switch_theme">Un-listed Nfts</a>
                                             <a class="btn btn-outline-dark border-rounded btn-padding me-2 show_listed_nfts switch_theme">Listed Nfts</a>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-3">
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                        <div class="card switch_theme">
                           <div class="card-body">
                              <div class="unlisted_nfts">
                                 <center>
                                    <div class="vertical-center">
                                       <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                                          <div class="progress-bar" style="width: 10%; display: none;"></div>
                                       </div>
                                    </div>
                                 </center>
                              </div>
                              <div class="listed_nfts d-none">
                                 <center>
                                    <div class="vertical-center">
                                       <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                                          <div class="progress-bar" style="width: 10%; display: none;"></div>
                                       </div>
                                    </div>
                                 </center>
                              </div>
                              <div id="pagination_unlisted"></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="transaction_history_display" class="display_panel d-none">
                     <div class="row " style="max-width: 1000px;">
                        <div class="col-12 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <h4 class="card-title">Transaction History</h4>
                                 <div class="row">
                                    <div class="col-sm-6" style=" margin: auto;width: 50%;    text-align: center;     font-size: 20px;">
                                       <div >Buys: <span class="buys_total text-white"></span></div>
                                       <div>Sales: <span class="sales_total text-white"></span></div>
                                    </div>
                                    <div class="col-sm-6">
                                       <canvas id="transaction_history_chart" style="max-width:300px; max-height:300px" class="transaction-chart"></canvas>
                                    </div>
                                 </div>
                                 <div class="transaction_history_divs">
                                    <center>
                                       <div class="row" style="height: 400px;">
                                          <img class="col align-self-center" style="max-height: 140px; max-width: 140px; margin-left: auto; margin-right: auto;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                                       </div>
                                    </center>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-8 d-none">
                           <canvas id="transaction_history" width="400" height="400"></canvas>
                        </div>
                     </div>
                  </div>
                  <div id="collection_activities_display" class="display_panel d-none">
                     <span id="recent_activity"></span>
                     <table id="collection_activities" class="table display nowrap w-100">
                        <thead>
                           <tr style="background: #f5f5f5;">
                              <td class="pname">
                                 NFT
                              </td>
                              <td>Time</td>
                              <td>Price</td>
                              <td>From</td>
                              <td>To</td>
                           </tr>
                        </thead>
                        <!--                                                             <tbody></tbody>-->
                        <!--                               <tfoot>-->
                        <!-- <tr>-->
                        <!--  <th colspan="3">Total</th>-->
                        <!--  <th id="total_order"></th>-->
                        <!-- </tr>-->
                        <!--</tfoot>-->
                     </table>
                  </div>
                  <div id="send_nft_message" class="display_panel d-none">
                     <div class="container message_div switch_theme" style="max-width: 1000px;">
                        <div class="row" style="max-height: 700px;">
                           <div class="col-sm mt-3 d-flex justify-content-center">
                              <div id="nft_message_display" class="image_message" style="background-image: url('assets/images/nearkits-message.png');">
                                 <br />
                                 <br />
                                 <div id="nft_message" style=""></div>
                              </div>
                           </div>
                           <div class="col-sm mt-3 my-auto">
                              <div class="form-group">
                                 <label for="select_message_theme" class="text-dark">Select Theme</label>
                                 <select class="form-control text-white switch_theme light" id="select_message_theme">
                                    <option value="default">NEARKits Light</option>
                                    <option class="the-wooks" disabled value="the-wooks">The Wooks</option>
                                    <option class="el-cartel" disabled value="el-cartel">El cafe cartel</option>
                                    <option class="near-misfits" disabled value="near-misfits">Near Misfits</option>
                                 </select>
                              </div>
                              <form id="nft_message_form">
                                 <div class="form-group">
                                    <input type="text" class="form-control switch_theme border-rounded text-white" id="near_address_send" required placeholder="NEAR address" />
                                 </div>
                                 <div class="form-group">
                                    <textarea class="form-control switch_theme border-rounded text-white" required id="nft_message_text" rows="10" style="height: auto;" placeholder="Write Message"></textarea>
                                 </div>
                                 <button type="submit" class="btn btn-dark p-2 border-rounded w-100">Send Message</button>
                              </form>
                              <div id="image"></div>
                           </div>
                           <div>
                              <div id="canvas_2"></div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="manage_messages_display" class="display_panel d-none">
                     <div class="display_messages">
                        <center class="reload_remove_message">
                           <div class="row" style="height: 400px;">
                              <img class="col align-self-center" style="max-height: 140px; max-width: 140px; margin-left: auto; margin-right: auto;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                           </div>
                        </center>
                     </div>
                  </div>
                  <div id="gallery_select_display" class="display_panel d-none row">
                     <div class="col-sm-6 col-md-6 col-lg-4">
                        <div class="card switch_theme border-rounded p-0 mt-2">
                           <img class="card-img-top img-fluid" src="https://nearkits.io/assets/images/background/default-3.png" alt="Card image cap">
                           <div class="card-body">
                              <h5 class="card-title text-white">Default</h5>
                              <p class="card-text text-white">Nearkits Basic UI </p>
                              <button value="default" class="btn btn-dark p-2 border-rounded w-100 select_gallery_theme" disabled>Select</button>
                           </div>
                        </div>
                     </div>
                     <div class="col-sm-6 col-md-6 col-lg-4 mt-2">
                        <div class="card switch_theme border-rounded p-0">
                           <img class="card-img-top img-fluid" src="https://nearkits.io/assets/images/background/the_city.png" alt="Card image cap">
                           <div class="card-body">
                              <h5 class="card-title text-white">The City</h5>
                              <p class="card-text text-white">Start Of something</p>
                              <button value="the_city" class="btn btn-dark p-2 border-rounded w-100 select_gallery_theme" disabled>Select</button>
                           </div>
                        </div>
                     </div>
                     <div class="col-sm-6 col-md-6 col-lg-4 mt-2">
                        <div class="card switch_theme border-rounded p-0">
                           <img class="card-img-top img-fluid" src="https://nearkits.io/assets/images/background/asac.png" alt="Card image cap">
                           <div class="card-body">
                              <h5 class="card-title text-white">Asac</h5>
                              <p class="card-text text-white">Return to Monke</p>
                              <button value="asac_nft" class="btn btn-dark p-2 border-rounded w-100 select_gallery_theme" disabled>Select</button>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div id="snipe_display" class="display_panel d-none">
                     <div class="row">
                        <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                           <div class="card switch_theme">
                              <div class="card-body">
                                 <div class="row">
                                    <div class="col-12">
                                       <div class="d-flex align-items-center align-self-start">
                                          <div class="col-12">
                                             <form class="search_nft_snipe_form">
                                                <div class="input-group mb-2">
                                                   <input type="text" class="switch_theme search_bar text-dark" id="search_nft_snipe_collection" placeholder="Search Nft collection" />
                                                   <div class="input-group-prepend">
                                                      <button class="input-group-text search_account_btn search_bar_icon" type="submit" style="cursor: pointer;"><i class="mdi mdi-magnify text-muted"></i></button>
                                                   </div>
                                                </div>
                                             </form>
                                             <div class="row snipe_collection_stats d-none">
                                                <div class="col-md-4 mt">
                                                   <div class="border-rounded p-3 theme-dark-bg">
                                                      <h5 class="mb-0 reload_divs text-white">Total Owners </h5>
                                                      <div class="ml-auto mt-2 font-weight-medium usd_show text-white" id="snipe_total_owners"></div>
                                                   </div>
                                                </div>
                                                <div class="col-md-4">
                                                   <div class="border-rounded p-3 theme-dark-bg">
                                                      <h5 class="mb-0 reload_divs text-white">Supply </h5>
                                                      <div class="ml-auto mt-2 font-weight-medium usd_show text-white" id="snipe_total_cards"></div>
                                                   </div>
                                                </div>
                                                <div class="col-md-4">
                                                   <div class="border-rounded p-3 theme-dark-bg">
                                                      <h5 class="mb-0 reload_divs text-white">Floor Price </h5>
                                                      <div class="ml-auto mt-2 font-weight-medium usd_show text-white" id="snipe_floor_price"></div>
                                                   </div>
                                                </div>
                                             </div>
                                          </div>
                                       </div>
                                    </div>
                                    <div class="col-3">
                                       <!-- <div class="icon icon-box-success ">
                                          <span class="mdi mdi-arrow-top-right icon-item"></span>
                                          </div> -->
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="row snipe_collection_stats floor_price_div d-none">
                        <div class="col-md-6">
                           <canvas id="listings_count_chart" style="width:100%; height:100%"></canvas>
                        </div>
                        <div class="col-md-6">
                           <canvas id="floorprice_count_chart"  style="width:100%; height:100%"></canvas>
                        </div>
                     </div>
                     <div id="load_snipe_collection" class="row mt-5"></div>
                  </div>
                  <div id="whale_tracker_display" class="display_panel d-none row">
                     <div class="col-xl-9 col-sm-12 grid-margin stretch-card">
                        <div class="card switch_theme"   style="height: 100px;">
                           <div class="card-body">
                              <form class="search_whale_account_form">
                                 <div class="input-group mb-2">
                                    <input type="text" class="switch_theme search_bar text-dark" id="search_whale_account" placeholder="Near Account" />
                                    <div class="input-group-prepend">
                                       <button class="input-group-text search_account_btn search_bar_icon" type="submit" style="cursor: pointer;"><i class="mdi mdi-magnify text-muted"></i></button>
                                    </div>
                                 </div>
                              </form>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-9 whale_search_info d-none">
                        <div class="row">
                           <div class="col-md-6">
                              <div class="card switch_theme">
                                 <div class="card-body">
                                    <div class="card-title">Recent Buys</div>
                                    <div class="whale_buys">
                                    </div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-md-6">
                              <div class="card switch_theme">
                                 <div class="card-body">
                                    <div class="card-title">Recent Sales</div>
                                    <div class="whale_sales">
                                    </div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-3">
                        <div class="row">
                           <div class="col-xl-12 col-md-6 mt-3">
                              <div class="card switch_theme">
                                 <div class="card-body">
                                    <div class="card-title">Top Buyers</div>
                                    <div class="top_buyers"></div>
                                 </div>
                              </div>
                           </div>
                           <div class="col-xl-12 col-md-6 mt-3">
                              <div class="card switch_theme">
                                 <div class="card-body">
                                    <div class="card-title">Top Sellers</div>
                                    <div class="top_sellers"></div>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                     <div class="col-xl-9 col-sm-12 whale_search_info d-none grid-margin stretch-card mt-5">
                        <div class="card switch_theme">
                           <div class="card-body">
                              <div class="whale_nfts_held"></div>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- content-wrapper ends -->
               <!-- partial:partials/_footer.html -->
               <footer class="footer switch_theme">
                  <div class="d-sm-flex justify-content-center justify-content-sm-between">
                     <span style="font-size: 20px;" class="float-none float-sm-right d-block mt-1 mt-sm-0 text-center">
                     <a href="https://twitter.com/NearKits_io"><i class="mdi mdi-twitter text-muted"></i></a><a href="https://discord.gg/7cStrsF7uf"><i class="mdi mdi-discord text-muted"></i></a>
                     </span>
                     <span class="text-muted d-block text-center text-sm-left d-sm-inline-block">Copyright  NEARKits </span>
                  </div>
               </footer>
               <div class="modal fade" id="nft_transfer" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content border-rounded switch_theme">
                        <div class="modal-header">
                           <label>
                           <span data-dismiss="modal" aria-label="Close" class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                           </label>
                           <h5 class="modal-title text-white" id="transfer_address_label">Transfer Nft</h5>
                        </div>
                        <form class="transfer_form">
                           <div class="modal-body">
                              <div class="form-group">
                                 <label for="transfer_address"></label>
                                 <input type="text" class="form-control switch_theme text-dark" id="transfer_address" aria-describedby="transfer_help" placeholder="Enter Address" />
                                 <small id="transfer_help" class="form-text text-muted">Make sure the receiver has enough near for storage!</small>
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              <button type="submit" class="btn btn-dark border-rounded btn-padding me-2 transfer_nft_btn">Transfer</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
               <div class="modal fade" id="batch_nft_transfer" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content border-rounded switch_theme">
                        <div class="modal-header">
                           <label>
                           <span data-dismiss="modal" aria-label="Close" class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                           </label>
                           <h5 class="modal-title text-white" id="transfer_address_label">Batch Transfer Nfts</h5>
                        </div>
                        <form class="transfer_form">
                           <div class="modal-body">
                              <h5 class="transfer_amount text-dark"></h5>
                              <div class="form-group">
                                 <label for="transfer_address"></label>
                                 <input type="text" class="form-control switch_theme text-dark" id="batch_transfer_address" aria-describedby="transfer_help" placeholder="Enter Address" />
                                 <small id="transfer_help" class="form-text text-muted">Make sure the receiver has enough near for storage!</small>
                              </div>
                           </div>
                           <div class="modal-footer">
                              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                              <button type="submit" class="btn btn-dark border-rounded btn-padding me-2 batch_transfer_nft_btn">Transfer</button>
                           </div>
                        </form>
                     </div>
                  </div>
               </div>
               <div class="modal" id="loading_modal" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content border-rounded switch_theme">
                        <center>
                           <div class="row" style="height: 400px;">
                              <img class="col align-self-center" style="max-height: 140px; max-width: 140px; margin-left: auto; margin-right: auto;" src="https://nearkits.io/assets/images/loading_circle.svg" />
                           </div>
                        </center>
                     </div>
                  </div>
               </div>
               <div class="modal" id="message_display_modal" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered" role="document">
                     <div class="modal-content border-rounded border-rounded switch_theme">
                        <div class="modal-header">
                           <label>
                           <span data-dismiss="modal" aria-label="Close" class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                           </label>
                           <h5 class="modal-title text-white" id="transfer_address_label">View Message</h5>
                        </div>
                        <div class="modal-body">
                           <img id="message_display_modal_image" class="img-fluid" />
                        </div>
                        <div class="modal-footer">
                           <h4 id="from_user" class="text-dark"></h4>
                           <p id="message_timestamp" class="text-dark"></p>
                           <button class="btn btn-sm btn-danger" id="delete_message">Delete</button>
                           <a class="btn btn-sm btn-info" href="#send_nft_message" id="reply_message">Reply</a>
                        </div>
                     </div>
                  </div>
               </div>
               <div class="modal" id="display_nft_info_modal" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
                  <div class="modal-dialog modal-dialog-centered modal-lg" role="document" style="max-width: 1000px;">
                     <div class="modal-content border-rounded switch_theme">
                        <div class="modal-body">
                           <label>
                           <span class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                           </label>
                           <div class="row">
                              <div class="col-md-6">
                                 <div class="vertical_center_container">
                                    <img id="nft_display_modal_image" class="img-fluid vertical_center" style="max-height: 300px;" />
                                 </div>
                              </div>
                              <div class="col-md-6">
                                 <h5 id="nft_modal_title" class="text-dark mt-3" style="font-weight: bold;"></h5>
                                 <p id="nft_modal_floor_price" class="text-dark mb-0"></p>
                                 <p id="nft_modal_floor_price_usd" class="text-dark mb-0"></p>
                                 <p id="nft_modal_score" class="text-dark mb-0"></p>
                                 <div id="display_nft_attributes" class="row"></div>
                              </div>
                           </div>
                        </div>
                        <div class="modal-footer nft_modal_footer justify-content-center">
                           <a href="#activity" class="btn btn-outline-dark view_collection_activtiy border-rounded btn-padding" style="margin-left: auto;" collection="">Activity</a>
                        </div>
                     </div>
                  </div>
               </div>
               <!-- partial -->
            </div>
            <div class="modal fade" id="batch_nft_bid" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
               <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content border-rounded switch_theme">
                     <div class="modal-header">
                        <label>
                        <span data-dismiss="modal" aria-label="Close" class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                        </label>
                        <h5 class="modal-title text-white" id="transfer_address_label">Batch Bid Nfts</h5>
                     </div>
                     <form class="transfer_form">
                        <div class="modal-body">
                           <h5 class="bid_amount text-dark"></h5>
                           <h5 class="bid_cost text-dark"></h5>
                           <h5 class="wallet_balance text-dark"></h5>
                           <div class="form-group">
                              <label for="transfer_address"></label>
                              <input type="number" class="form-control switch_theme text-dark border-rounded" id="bid_amount_input" aria-describedby="transfer_help" placeholder="Enter Amount" required step=".01" />
                              <small id="transfer_help" class="form-text text-muted"></small>
                           </div>
                        </div>
                        <div class="modal-footer">
                           <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                           <button type="submit" class="btn btn-dark border-rounded btn-padding me-2 batch_bid_nft_btn">Bid</button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
            <div class="modal" id="batch_nft_list" tabindex="-1" role="dialog" aria-labelledby="transfer_address_label" aria-hidden="true">
               <div class="modal-dialog modal-dialog-centered" role="document">
                  <div class="modal-content border-rounded switch_theme">
                     <div class="modal-header">
                        <label>
                        <span data-dismiss="modal" aria-label="Close" class="text-dark close_modal"><i class="mdi mdi-arrow-left text-dark" style="font-size: 14px;"></i><span style="font-size: 19px;">Back</span></span>
                        </label>
                        <h5 class="modal-title text-white" id="transfer_address_label">Batch List Nfts</h5>
                     </div>
                     <form class="transfer_form">
                        <div class="modal-body">
                           <h5 class="batch_nft_list_amount text-dark"></h5>
                           <h5 class="batch_nft_list_royalty text-dark"></h5>
                           <h5 class="batch_nft_list_fee text-dark"></h5>
                           <h5 class="batch_nft_list_recieve text-dark"></h5>
                        </div>
                        <div class="modal-footer">
                           <button type="button" class="btn btn-secondary " data-dismiss="modal">Close</button>
                           <button type="submit" data-type="list" class="btn btn-dark border-rounded btn-padding me-2 batch_list_nft_btn">List</button>
                        </div>
                     </form>
                  </div>
               </div>
            </div>
            <!-- main-panel ends -->
         </div>
         <!-- page-body-wrapper ends -->
      </div>
      <!-- container-scroller -->
      <!-- plugins:js -->
      <script src="assets/vendors/js/vendor.bundle.base.js"></script>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
      <script src="assets/js/simple-bootstrap-paginator.min.js"></script>
      <!--<script src="assets/js/bundle.js"></script>-->
      <!-- endinject -->
      <!-- Plugin js for this page -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
      <script src="assets/vendors/progressbar.js/progressbar.min.js"></script>
      <script src="assets/vendors/jvectormap/jquery-jvectormap.min.js"></script>
      <script src="assets/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
      <script src="assets/vendors/owl-carousel-2/owl.carousel.min.js"></script>
      <script src="assets/js/jquery.cookie.js" type="text/javascript"></script>
      <!-- End plugin js for this page -->
      <!-- inject:js -->
      <script src="assets/js/off-canvas.js"></script>
      <script src="assets/js/hoverable-collapse.js"></script>
      <script src="assets/js/misc.js"></script>
      <script src="assets/js/settings.js"></script>
      <script src="assets/js/todolist.js"></script>
      <script src="assets/js/notify.min.js"></script>
      <script src="assets/js/bs58.js"></script>
      <!-- endinject -->
      <!-- Custom js for this page -->
      <script src="assets/js/dashboard.js"></script>
      <script src="assets/js/datatables.min.js"></script>
      <script src="assets/js/dataTables.responsive.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/near-api-js@0.44.2/dist/near-api-js.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
      <script src="assets/js/pagination.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
      <script>
         mode_selected_function();
         let nft_array = [];
         $("#switch_mode_cbx").on("click", function () {
            if ($("#switch_mode_cbx").is(":checked")) {
               mode_selected = "dark";
            } else {
               mode_selected = "light";
            }
            localStorage.setItem("mode_selected", mode_selected);
            mode_selected_function();
         });
         function copyAddress() {
            var copyText = document.getElementById("copy_address");
         
            copyText.select();
            copyText.setSelectionRange(0, 99999); /* For mobile devices */
         
            navigator.clipboard.writeText(copyText.value);
         
            toastr.info("Your Address: " + copyText.value + " has been copied");
         }
         function mode_selected_function() {
            mode_selected = localStorage.getItem("mode_selected");
            if (mode_selected == "light") {
               $("#switch_mode_cbx").removeAttr("checked");
               $(".text-white").addClass("text-dark");
               $(".text-dark").removeClass("text-white");
               $(".theme-dark-bg").addClass("theme-white-bg");
               $(".theme-white-bg").removeClass("theme-dark-bg");
         
               $(".switch_theme").addClass("light");
               $(".brand-logo-mini-img").attr("src", "assets/images/logo-mini-black.png");
               $(".brand-logo-img").attr("src", "assets/images/logo-new-tp-black.png");
            } else {
               $("#switch_mode_cbx").prop("checked", true);
               $(".switch_theme").removeClass("light");
               $(".text-dark").addClass("text-white");
               $(".text-white").removeClass("text-dark");
               $(".theme-white-bg").addClass("theme-dark-bg");
               $(".theme-dark-bg").removeClass("theme-white-bg");
               $(".brand-logo-mini-img").attr("src", "assets/images/logo-mini-white.png");
               $(".brand-logo-img").attr("src", "assets/images/logo-new-tp-white.png");
            }
         }
         const near = new nearApi.Near({
            keyStore: new nearApi.keyStores.BrowserLocalStorageKeyStore(),
            networkId: "mainnet",
            nodeUrl: "https://rpc.mainnet.near.org",
            walletUrl: "https://wallet.mainnet.near.org",
         });
         
         // connect to the NEAR Wallet
         const wallet = new nearApi.WalletConnection(near, "Near Kits");
         
         const button = document.getElementById("Wallet");
         if (!wallet.isSignedIn()) {
            button.textContent = "Sign with NEAR";
         }
         
         $(document).on("click", ".transfer_nft", function () {
            $("#display_nft_info_modal").modal("hide");
            token_id = $(this).attr("value");
            contract_id_send = $(this).attr("contract_id");
            collection_name = $(this).attr("collection_name");
         });
         $(document).on("submit", ".transfer_form", function (e) {
            e.preventDefault();
            transfer_address = $("#transfer_address").val().toLowerCase();
            if (transfer_address.includes(".near") || transfer_address.length == 64) {
               transfer_nfts(contract_id_send, token_id, transfer_address);
            } else {
               // toastr.warning('Invalid account address!')
            }
         });
         $(".search_account_form").on("submit", function (e) {
            e.preventDefault();
            $(".usd_show").html("");
            $(".loading_array").addClass("d-none");
            account_type = "";
            $(".reload_divs").html('<img class="col align-self-center img-fluid" style="height:60px; width:60px" src="https://nearkits.io/assets/images/loading_circle.svg">');
            $("#display_account_info").removeClass("d-none");
            account_id = $("#search_account").val().toLowerCase();
            if (account_id.includes(".near") || account_id.length == 64) {
               $("#account_floor").val(account_id);
               get_total_floor(account_id);
               sort_filter_normal = $("#sort_filter_normal").val();
               load_nft_ajax(account_id, 1, sort_filter_normal);
            } else {
               toastr.warning("Invalid account address!");
            }
         });
         $("#logout").on("click", function () {
            wallet.signOut();
            location.reload();
         });
         $(document).on("click", ".wallet_sign", function () {
            // $("#display_account_info").removeClass("d-none")
            show_logout = $(".logout_drop").hasClass("show");
            if (show_logout) {
               $(".logout_drop").removeClass("show");
            } else {
               $(".logout_drop").addClass("show");
            }
         });
         account_type = "";
         if (wallet.isSignedIn()) {
            $("#display_account_info").removeClass("d-none");
            $(".dropdown_profile").removeClass("d-none");
            account_type = "signed_in";
            account_id = wallet._authData.accountId;
            confirm_el_cartel_check = false;
            confirm_el_cartel("cartelgen1.neartopia.near");
            confirm_wook = false;
            confirm_the_wooks("nearwooks.near");
            confirm_misfit = false;
            confirm_the_misfits("misfits.tenk.near");
            confirm_the_asac("asac.near");
            wall = false;
            confirm_access_card();
            select_custom_message();
            get_total_floor(account_id);
            stored_nfts_check = JSON.parse(localStorage.getItem(account_id + "AllNfts"));
            get_nft_array(account_id);
            my_nfts_display();
            if (account_id.length > 20) {
               $("#Wallet").html(account_id.slice(0, 20).concat("..."));
            } else {
               $("#Wallet").html(account_id);
            }
         
            $("#account_floor").val(account_id);
            total_floor_display = localStorage.getItem(account_id + "total_floor");
            if (total_floor_display) {
               start(parseFloat(total_floor_display), account_id);
            }
            if (stored_nfts_check) {
               initialize_stored_nfts(account_id);
            } else {
               sort_filter = $("#sort_filter").val();
               load_nft_ajax(account_id, 1, sort_filter);
            }
         } else {
            //      $("#Wallet").notify("Connect your wallet ser!",
            //   { position:"bottom left" });
            toastr.info("Connect your wallet!");
         }
         // Either sign in or call the addMessage change method on button click
         document.getElementById("Wallet").addEventListener("click", () => {
            if (wallet.isSignedIn()) {
               account_type = "signed_in";
               button.textContent = wallet._authData.accountId;
               get_total_floor(account_id);
               load_nft(account_id);
            } else {
               wallet.requestSignIn(
                  "nearkits.near",
                  "Near Kits", // optional
                  "https://nearkits.io", // optional
                  "https://nearkits.io"
               );
               $(".navbar-profile-name").html(wallet.accountId);
               load_nft();
               console.log(wallet.accountId);
            }
         });
         
         function loading_bar() {
            $(".progress-bar").css("width", "0%");
            $(".progress").fadeIn();
            $(".progress-bar").fadeIn();
         
            setTimeout(function () {
               $(".progress-bar").css("width", "30%");
               setTimeout(function () {
                  $(".progress-bar").css("width", "40%");
                  setTimeout(function () {
                     $(".progress-bar").css("width", "50%");
                     setTimeout(function () {
                        $(".progress-bar").css("width", "60%");
                        setTimeout(function () {
                           $(".progress-bar").css("width", "75%");
                           setTimeout(function () {
                              $(".progress-bar").css("width", "90%");
                              setTimeout(function () {
                                 $(".progress-bar").css("width", "95%");
                              }, 15000);
                           }, 7000);
                        }, 5000);
                     }, 5000);
                  }, 3000);
               }, 4000);
            }, 2000);
         }
         
         function initialize_stored_nfts(account_id) {
            stored_nfts_check = JSON.parse(localStorage.getItem(account_id + "AllNfts"));
            stored_nfts_count = stored_nfts_check.html;
            sort_filter = $("#sort_filter").val();
         
            $("#pagination_stored").whjPaging({
               firstPage: "<<",
               previousPage: "<",
               nextPage: ">",
               lastPage: ">>",
               isShowTotalSize: false,
               isShowTotalPage: false,
               isShowRefresh: false,
               isShowSkip: false,
               isShowPageSizeOpt: false,
               isResetPage: false,
               totalSize: stored_nfts_count.length,
               totalPage: Math.ceil(stored_nfts_count.length / sort_filter),
               callBack: function (currPage, pageSize) {
                  load_stored_nfts(sort_type, currPage, sort_filter);
               },
            });
            sort_type = $("#select_filter").val();
            load_stored_nfts(sort_type, 1, sort_filter);
         }
         
         async function transfer_nfts(contract_id, token_id) {
            try {
               const contract = await new nearApi.Contract(wallet.account(), contract_id, {
                  changeMethods: ["nft_transfer"],
               });
               const formattedParams = {
                  token_id: token_id,
                  receiver_id: transfer_address,
               };
         
               const ret = await contract.nft_transfer(formattedParams, 270000000000000, "1");
            } catch (error) {
               console.log(error);
               toastr.warning("this nft can't be transferred");
            }
         }
         
         function load_nft(account_id) {
            search_title = "";
            $("#pagination1").removeData();
            $("#pagination1").removeClass("d-none");
            $.ajax({
               type: "POST",
               url: "https://nearkits.io/php/get_nft_pages.php",
               dataType: "json",
               data: {
                  account_id: account_id,
               },
               success: function (response) {
                  if (response.total_pages > 0) {
                     $("#totalPages").attr("value", response.total_pages);
                     if (response.total_nft_count < 2) {
                        $("#total_nft_count").html(response.total_nft_count + " Nft");
                     } else {
                        $("#total_nft_count").html(response.total_nft_count + " Nfts");
                     }
                     var totalPage = response.total_pages;
                     var totalPage = parseInt($("#totalPages").val());
                     var pag = $("#pagination1").simplePaginator({
                        totalPages: totalPage,
                        maxButtonsVisible: 5,
                        currentPage: 1,
                        nextLabel: "Next",
                        prevLabel: "Prev",
                        firstLabel: "First",
                        lastLabel: "Last",
                        clickCurrentPage: true,
                        pageChange: function (page) {
                           $("#display_nfts_1").html(
                              '<center><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
                           );
                           $.ajax({
                              url: "https://nearkits.io/php/get_nfts.php",
                              method: "POST",
                              dataType: "json",
                              data: {
                                 page: page,
                                 account_type: account_type,
                                 account_id: account_id,
                                 mode_selected: mode_selected,
                              },
                              success: function (responseData) {
                                 $("#display_nfts1").html(responseData.html);
                                 mode_selected_function();
                                 $("#nfts_count").html(responseData.nfts_count);
                              },
                           });
                        },
                     });
                  } else {
                     $("#display_nfts").html("<div class='text-center'><h6>You have no Nfts yet!</h6></div>");
                     start(0, account_id);
                     $("#nfts_count").html("0");
                     $("#pagination").addClass("d-none");
                  }
               },
            });
         }
         
         function load_nft_ajax(account_id, currPage, pageSize) {
            search_title = "";
            $("#pagination").removeData();
            $("#display_nfts").removeClass("d-none");
            $("#pagination").removeClass("d-none");
            $("#normal_nfts").removeClass("d-none");
            $("#stored_nfts").addClass("d-none");
            $("#display_stored_nfts").addClass("d-none");
            $("#pagination_stored").addClass("d-none");
            $("#select_filter").prop("disabled", true);
            $.ajax({
               type: "POST",
               url: "https://nearkits.io/php/get_nft_pages.php",
               dataType: "json",
               data: {
                  account_id: account_id,
                  pageSize: pageSize,
               },
               success: function (response) {
                  if (response.total_pages > 0) {
                     $("#totalPages").attr("value", response.total_pages);
                     if (response.total_nft_count < 2) {
                        $("#total_nft_count").html(response.total_nft_count + " Nft");
                     } else {
                        $("#total_nft_count").html(response.total_nft_count + " Nfts");
                     }
                     $("#pagination").whjPaging("setPage", {
                        currPage: currPage,
                        totalPage: response.total_pages,
                        totalSize: response.total_nft_count,
                     });
         
                     loadData(currPage, pageSize);
                  } else {
                     $("#display_nfts").html("<div class='text-center'><h6>You have no Nfts yet!</h6></div>");
                     start(0, account_id);
                     $("#nfts_count").html("0");
                     $("#pagination").addClass("d-none");
                  }
               },
            });
         }
         
         function loadData(currPage, pageSize) {
            $("#display_nfts").html(
               '<center><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
            $.ajax({
               url: "https://nearkits.io/php/get_nfts.php",
               method: "POST",
               dataType: "json",
               data: {
                  page: currPage,
                  pageSize: pageSize,
                  account_type: account_type,
                  account_id: account_id,
                  mode_selected: mode_selected,
               },
               success: function (responseData) {
                  $("#display_nfts").html(responseData.html);
                  mode_selected_function();
                  $("#nfts_count").html(responseData.nfts_count);
               },
            });
         }
         
         $("#select_filter").on("change", function () {
            sort_type = $("#select_filter").val();
            sort_filter = $("#sort_filter").val();
            load_stored_nfts(sort_type, 1, sort_filter);
         });
         
         $("#sort_filter_normal").on("change", function () {
            search_account_id = $("#search_account").val().toLowerCase();
            sort_filter_normal = $("#sort_filter_normal").val();
            $("#display_stored_nfts").html(
               '<center  class="reload_remove_here"><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
            load_nft_ajax(search_account_id, 1, sort_filter_normal);
         });
         
         $("#sort_filter").on("change", function () {
            sort_type = $("#select_filter").val();
            sort_filter = $("#sort_filter").val();
            load_stored_nfts(sort_type, 1, sort_filter);
            toastr.success("Displaying " + sort_filter + " Nfts");
         });
         function load_stored_nfts(sort_type, currPage, pageSize) {
            $("#display_stored_nfts").html("");
            $("#display_stored_nfts").html(
               '<center  class="reload_remove_here"><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
            stored_nfts = JSON.parse(localStorage.getItem(account_id + "AllNfts"));
            stored_nfts_count = stored_nfts.html;
            $("#pagination_stored").whjPaging("setPage", {
               currPage: currPage,
               totalPage: Math.ceil(stored_nfts_count.length / sort_filter),
               totalSize: pageSize,
            });
            if (pageSize > 1) {
               $("#total_nft_count").html(stored_nfts_count.length + " Nft");
            } else {
               $("#total_nft_count").html(stored_nfts_count.length + " Nfts");
            }
         
            if (stored_nfts) {
               $("#select_filter").prop("disabled", false);
               $("#normal_nfts").addClass("d-none");
               $("#display_nfts").addClass("d-none");
               $("#pagination").addClass("d-none");
               $("#stored_nfts").removeClass("d-none");
               $("#display_stored_nfts").removeClass("d-none");
               $("#pagination_stored").removeClass("d-none");
               stored_nfts_array = stored_nfts.html;
               start_array = (currPage - 1) * pageSize;
               end = currPage * pageSize;
               if (sort_type == "Alphabetically") {
                  function SortAlphabeticall(x, y) {
                     return x.collection.localeCompare(y.collection);
                  }
                  stored_nfts_array.sort(SortAlphabeticall);
               } else if (sort_type == "Highest") {
                  stored_nfts_array.sort((a, b) => parseFloat(b.floor_price) - parseFloat(a.floor_price));
               } else if (sort_type == "Lowest") {
                  stored_nfts_array.sort((a, b) => parseFloat(a.floor_price) - parseFloat(b.floor_price));
               } else if (sort_type == "RarityHigh") {
                  stored_nfts_array.sort((a, b) => parseFloat(b.score) - parseFloat(a.score));
               } else if (sort_type == "RarityLow") {
                  stored_nfts_array.sort((a, b) => parseFloat(a.score) - parseFloat(b.score));
               } else if (sort_type == "Staked") {
                  stored_nfts_array.sort(function (x, y) {
                     // true values first
                     return x === y ? 0 : x ? -1 : 1;
                     // false values first
                     // return (x === y)? 0 : x? 1 : -1;
                  });
               }
               stored_nfts_array_sort = stored_nfts_array.slice(start_array, end);
               $("#nfts_count").html(stored_nfts_array_sort.length);
               load_nft_list_array = "";
               for (i in stored_nfts_array_sort) {
                  if (i !== "sum") {
                     if (stored_nfts_array_sort[i].collection == "dragonnation.near") {
                        title_nft = "NEAR Dragon Nation";
                        staked_link = "https://www.neardragons.com/staking";
                     } else if (stored_nfts_array_sort[i].collection == "undead.secretskelliessociety.near") {
                        title_nft = "The Undead Army";
                        staked_link = "https://skellieverse.com/stake";
                     } else if (stored_nfts_array_sort[i].collection == "secretskelliessociety.near") {
                        title_nft = "Secret Skellies Society";
                        staked_link = "https://skellieverse.com/stake";
                     } else if (stored_nfts_array_sort[i].collection == "grimms.secretskelliessociety.near") {
                        title_nft = "Grimms Army";
                        staked_link = "https://skellieverse.com/stake";
                     } else if (stored_nfts_array_sort[i].collection == "estates.secretskelliessociety.near") {
                        title_nft = "Skullingham Estates";
                        staked_link = "https://skellieverse.com/stake";
                     } else if (stored_nfts_array_sort[i].collection == "nft1.vexedapesmint.near") {
                        title_nft = "Vexed Apes Club";
                        staked_link = "https://staking.vexedapesclub.com";
                     } else if (stored_nfts_array_sort[i].collection == "vexedapesclub.near") {
                        title_nft = "Vexed Apes Club";
                        staked_link = "https://staking.vexedapesclub.com";
                     } else if (stored_nfts_array_sort[i].collection == "kokumokongz.near") {
                        title_nft = "Kokumo KongZ";
                        staked_link = "https://staking.kokumokongz.net/";
                     } else {
                        title_nft = stored_nfts_array_sort[i].collection;
                        staked_link = "";
                     }
         
                     if (stored_nfts_array_sort[i].is_staked) {
                        btn_action = ` <a class="btn btn-dark border-rounded btn-padding transfer_nft me-2" href="${staked_link}">Staked</a>`;
                     } else {
                        btn_action = ` <button class="btn btn-dark border-rounded btn-padding transfer_nft me-2" value="${stored_nfts_array_sort[i].token_id}" contract_id="${stored_nfts_array_sort[i].contract_id}" collection_name="${stored_nfts_array_sort[i].collection}" data-toggle="modal" data-target="#nft_transfer">Transfer</button>`;
                     }
                     load_nft_array = `
                             <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card display_nft_info" style="text-decoration: none;" href="#display_nft_info"
                             data-token_id="${stored_nfts_array_sort[i].token_id}"
                             data-contract_id="${stored_nfts_array_sort[i].contract_id}"
                             data-image="${stored_nfts_array_sort[i].image}"
                             data-title="${stored_nfts_array_sort[i].title}"
                             data-floor_price="${stored_nfts_array_sort[i].floor_price} "
                             data-floor_price_usd=" $${stored_nfts_array_sort[i].floor_price_usd}"
                             data-score="Rarity: ${stored_nfts_array_sort[i].score}"
                             data-collection="${stored_nfts_array_sort[i].collection}"
                             data-title_nft="${title_nft}"
                             data-staked_link="${staked_link}"
                             data-type="load_stored"
                             >
                             <a  style="text-decoration: none;" href="#display_nft_info">
                             <div class="card switch_theme">
                              <img class="card-img-top img-fluid" src="${stored_nfts_array_sort[i].image}" style="width:100% ; height: 200px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2">
                                 <h5 class="card-title text-white">${stored_nfts_array_sort[i].title}</h5>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow p-0">
                                         <div class="flex-grow">
                                           <div class="d-flex d-md-flex d-xl-flex justify-content-start">
                                           <div class="d-block">
                                             <p class="text-white text-small">Floor price: ${stored_nfts_array_sort[i].floor_price} </p>
                                             <p class="text-white text-small d-flex justify-content-start">
                                               $${stored_nfts_array_sort[i].floor_price_usd}</p>
                                              <p class="text-white text-small d-flex justify-content-start">
                                              Rarity : ${stored_nfts_array_sort[i].score}</p>
                                              </div>
                                           </div>
                                          
                                           <h5 class="text-white"><a class="text-white" href="https://paras.id/search?q=${stored_nfts_array_sort[i].collection}">${title_nft}</a></h5>
                                           </div>
                                           
                                 
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               
                             </div>
                             </a>
                           </div>
                             `;
                     load_nft_list_array = load_nft_list_array + load_nft_array;
                  }
               }
               $("center").remove(".reload_remove_here");
               $("#display_stored_nfts").append(load_nft_list_array);
               mode_selected_function();
            }
         }
         
         $("#pagination").whjPaging({
            firstPage: "<<",
            previousPage: "<",
            nextPage: ">",
            lastPage: ">>",
            isShowTotalSize: false,
            isShowTotalPage: false,
            isShowRefresh: false,
            isShowSkip: false,
            isShowPageSizeOpt: false,
            isResetPage: false,
            callBack: function (currPage, pageSize) {
               loadData(currPage, pageSize);
            },
         });
         Array.prototype.sum = function (prop) {
            var total = 0;
            for (var i = 0, _len = this.length; i < _len; i++) {
               total += parseFloat(this[i][prop]);
            }
            return total;
         };
         async function start(total_floor_display, account_id) {
            try {
               await $.ajax({
                  type: "GET",
                  url: "https://api.coingecko.com/api/v3/simple/price?ids=NEAR&vs_currencies=USD",
                  dataType: "json",
                  success: function (response) {
                     near_usd = response.near.usd;
                  },
               });
               // gets account balance
               const account = await near.account(account_id);
               balance = await account.getAccountBalance();
               check_if_stored = JSON.parse(localStorage.getItem(account_id + "AllNfts"));
               if (check_if_stored && account_id == wallet._authData.accountId) {
                  get_account_value = JSON.parse(localStorage.getItem(account_id + "AllNfts")).html;
                  total_floor_display = get_account_value.sum("floor_price");
               }
         
               $("#total_floor").html(total_floor_display.toLocaleString() + " ");
               $("#usd_near_floor").html(" $" + parseFloat((total_floor_display.toFixed(2) * parseFloat(near_usd)).toFixed(2)).toLocaleString());
         
               total_balance_raw = balance.available / 1000000000000000000000000;
               total_balance = parseFloat(total_balance_raw.toFixed(2));
               $(".wallet_balance").html("You have " + total_balance.toLocaleString() + " ");
               $("#liquid_near").html(total_balance.toLocaleString() + " ");
               $("#usd_near_liquid").html(" $" + parseFloat((total_balance.toFixed(2) * parseFloat(near_usd)).toFixed(2)).toLocaleString());
         
               staked_balance = balance.staked / 1000000000000000000000000;
               $("#staked_near").html(staked_balance.toLocaleString() + " ");
               $("#usd_near_staked").html(" $" + parseFloat((staked_balance.toFixed(2) * parseFloat(near_usd)).toFixed(2)).toLocaleString());
         
               total_value = (parseFloat(total_balance) + parseFloat(total_floor_display) + parseFloat(staked_balance)).toFixed(2);
               $("#total_value").html(parseFloat(total_value).toLocaleString() + " ");
               $("#usd_near_total").html(" $" + parseFloat((total_value * parseFloat(near_usd)).toFixed(2)).toLocaleString());
               $(".progress-bar").css("width", "0%");
               $(".progress-bar").fadeOut();
               $(".progress").fadeOut();
            } catch (error) {
               console.log(error);
               toastr.warning("Invalid account address!");
               $(".progress-bar").fadeOut();
               $(".progress").fadeOut();
            }
         }
         
         function get_nft_array(account_id) {
            $.ajax({
               type: "POST",
               url: "https://nearkits.io/php/get_nft_array.php",
               dataType: "json",
               data: {
                  account_id: account_id,
               },
               success: function (response) {
                  localStorage.setItem(account_id + "AllNfts", JSON.stringify(response));
         
                  get_staking_partners();
         
                  $(".loading_array").addClass("d-none");
               },
            });
         }
         
         function get_total_floor(account_id) {
            $.ajax({
               type: "POST",
               url: "https://nearkits.io/php/get_floor_price.php",
               dataType: "json",
               data: {
                  account_id: account_id,
               },
               success: function (response) {
                  total_floor_display = parseFloat(response.total_floor);
                  if (wallet._authData.accountId == account_id) {
                     localStorage.setItem(account_id + "total_floor", total_floor_display);
                  }
                  account_floor = $("#account_floor").val();
                  if (account_floor == account_id) {
                     start(total_floor_display, account_id);
                  }
               },
            });
         }
         $(document).on("click", ".view_collection_activtiy", function () {
            collection_id = $(this).attr("collection_id");
            collection_name = $(this).attr("collection");
            localStorage.setItem("collection_id", collection_id);
            localStorage.setItem("collection_name", collection_name);
            load_activity();
         });
         $(window).bind("hashchange", function () {
            load_window_hash();
         });
         window.onhashchange = function () {
            load_window_hash();
         };
         load_window_hash();
         
         function load_window_hash() {
            if (window.location.hash === "#activity") {
               $("#my_nfts_display").addClass("d-none");
               $("#dashboard_display").addClass("d-none");
               $("#send_nft_message").addClass("d-none");
               $(".display_panel").addClass("d-none");
               load_activity();
            } else if (window.location.hash === "#send_nft_message") {
               $("#collection_activities_display").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#send_nft_message_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#send_nft_message").removeClass("d-none");
            } else if (window.location.hash === "#my_nfts") {
               $("#collection_activities_display").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#my_nfts_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#my_nfts_display").removeClass("d-none");
            } else if (window.location.hash === "#manage_messages") {
               $("#collection_activities_display").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#manage_messages_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#manage_messages_display").removeClass("d-none");
            } else if (window.location.hash === "#batch_offer" || window.location.hash === "#display_collection_info") {
               $("#collection_activities_display").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#batch_offer_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#batch_offer_display").removeClass("d-none");
               load_offer_storage_info();
            } else if (window.location.hash === "#batch_list") {
               $("#collection_activities_display").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#batch_list_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#batch_list_display").removeClass("d-none");
               load_offer_storage_info();
            }
            else if (window.location.hash === "#gallery_select") {
         $("#collection_activities_display").addClass("d-none")
         $(".nav_select").removeClass("active")
         $("#gallery_select_nav").addClass("active")
         $(".display_panel").addClass("d-none") 
         $("#gallery_select_display").removeClass("d-none")
         }
         else if (window.location.hash === "#transaction_history") {
         $("#collection_activities_display").addClass("d-none")
         $(".nav_select").removeClass("active")
         $("#transaction_history_nav").addClass("active")
         $(".display_panel").addClass("d-none") 
         $("#transaction_history_display").removeClass("d-none")
         }else if (window.location.hash === "#snipe"||window.location.hash === "#display_snipe_collection_info") {
         $("#collection_activities_display").addClass("d-none")
         $(".nav_select").removeClass("active")
         $("#snipe_nav").addClass("active")
         $(".display_panel").addClass("d-none") 
         $("#snipe_display").removeClass("d-none")
         }else if (window.location.hash === "#whale_tracker"||window.location.hash === "#whale_tracker") {
         $("#collection_activities_display").addClass("d-none")
         $(".nav_select").removeClass("active")
         $("#whale_tracker_nav").addClass("active")
         $(".display_panel").addClass("d-none") 
         $("#whale_tracker_display").removeClass("d-none")
         }else {
               $("#collection_activities").addClass("d-none");
               $(".nav_select").removeClass("active");
               $("#dashboard_nav").addClass("active");
               $(".display_panel").addClass("d-none");
               $("#dashboard_display").removeClass("d-none");
            }
         }
         check_has_messages();
         
         function load_activity() {
            $("#collection_activities").DataTable().destroy();
            $("#dashboard_display").addClass("d-none");
            $("#send_nft_message").addClass("d-none");
            collection_name = localStorage.getItem("collection_name");
            token_series = localStorage.getItem("token_series");
            $("#recent_activity").html("Recent activity from " + collection_name);
            $("#collection_activities_display").removeClass("d-none");
            collection_id = localStorage.getItem("collection_id");
            sort_by = "";
         
            var dataTable = $("#collection_activities").DataTable({
               responsive: {
                  details: {
                     display: $.fn.dataTable.Responsive.display.modal({
                        header: function (row) {
                           var data = row.data();
                           return "Details for " + data[0] + " " + data[1];
                        },
                     }),
                     renderer: $.fn.dataTable.Responsive.renderer.tableAll({
                        tableClass: "table",
                     }),
                  },
               },
               processing: true,
               serverSide: true,
               order: [],
               ajax: {
                  url: "php/get_activities.php",
                  type: "POST",
                  data: {
                     collection_id: collection_id,
                     sort_by: sort_by,
                  },
               },
               columnDefs: [
                  {
                     targets: [0, 1, 2, 3],
                     orderable: false,
                  },
               ],
            });
            $("#collection_activities_length").addClass("d-none");
            $("#collection_activities_filter").addClass("d-none");
            $("#collection_activities_info").addClass("d-none");
         }
         
         function my_nfts_display() {
            $.ajax({
               type: "GET",
               url: `https://api.kitwallet.app/account/${account_id}/likelyNFTs`,
               data: {
                  account_id: account_id,
               },
               success: function (response) {
                  check_has_nfts(response, "load");
                  return nft_array;
               },
            });
         }
         
         search_nft_array = [];
         contract_id_array_input = [];
         var nft_object_array = [];
         search_nft_bool = false;
         $(".search_nft_form").on("submit", function (e) {
            e.preventDefault();
         
            search_nft_array = [];
            toSearch = $("#search_nft_collection").val().toUpperCase();
            if (!(toSearch == "")) {
               for (var i = 0; i < nft_object_array.length; i++) {
                  for (key in nft_object_array[i]) {
                     if (nft_object_array[i][key].indexOf(toSearch) != -1) {
                        search_nft_array.push(nft_object_array[i]);
                     }
                  }
               }
            } else {
               search_nft_array = nft_object_array;
            }
         
            contract_id_array_search = [];
            search_nft_array.forEach((element, index, array) => {
               contract_id_array_search.push(element.contract_id);
            });
            search_has_nfts(contract_id_array_search);
         });
         
         async function check_has_nfts(contract_id_array, load_type) {
            account_id = wallet._authData.accountId;
            $("#load_my_nfts").html("");
            for (i in contract_id_array) {
               contract_id_load = contract_id_array[i];
               const contract = new nearApi.Contract(
                  wallet.account(), // the account object that is connecting
                  contract_id_load,
                  {
                     viewMethods: ["nft_tokens_for_owner", "nft_metadata"],
                  }
               );
               try {
                  const response = await contract.nft_tokens_for_owner({
                     account_id: account_id,
                  });
                  // console.log(response)
                  if (response.length > 0) {
                     response;
                     const response_metadata = await contract.nft_metadata();
                     //   search_nft_array.push(response_metadata.name)
                     contract_id_array_input.push(contract_id_load);
                     nft_title = response_metadata.name.toUpperCase();
                     if (load_type !== "search") {
                        nft_object_array.push({
                           contract_id: contract_id_load,
                           nft_title: nft_title,
                        });
                     }
                     load_nft_top = '<h4 class="text-white">' + `(${response.length}) ` + response_metadata.name + '</h4><div class="row">';
                     load_nft_list = "";
                     for (i in response) {
                        if (i !== "sum") {
                           image_media = response[i].metadata.media;
                           nft_checked_title = response[i].metadata.title;
                           var image_url = "";
                           if (response_metadata.base_uri) {
                              var image_url = response_metadata.base_uri + "/" + image_media;
                           } else {
                              var image_url = image_media;
                           }
                           selected_border = "";
                           if (batch_nft_array.some((nft_obj) => nft_obj.image_url === image_url)) {
                              selected_border = "border-selected";
                           }
         
                           load_nft_native = `
           	       <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card">
           	          <div class="card switch_theme select_nft_batch ${selected_border}" data-token_id="${response[i].token_id}" data-contract_id="${contract_id_load}"
           	          data-image_url="${image_url}"
           	          >
           	            <img class="card-img-top img-fluid" src="${image_url}"  style="width: 100%; height: 200px;
             object-fit: cover;" alt="">
           	    <div class="card-footer"  style="position: relative">
                                 <h5 class="card-title text-dark mb-0">${nft_checked_title}</h5>
                                   
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow">
                                         <div class="flex-grow">
                                          
                                           <h3 class="text-white"><a class="text-white" href="#"></a></h3>
                                           <div class="d-flex justify-content-end">
                                          <button style="position: absolute; bottom: 10px;right: 10px;"class="btn btn-dark mt-auto border-rounded btn-padding me-2 transfer_nft d-none" value="${response[i].token_id}" contract_id="${contract_id_load}" collection_name="${response_metadata.name}"  data-toggle="modal" data-target="#nft_transfer">Transfer</button></div>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                             </div>
                              </div>
                          
           	    `;
                           load_nft_list = load_nft_list + load_nft_native;
                        }
                     }
         
                     load_nft_bottom = "</div>";
                     $("#load_my_nfts").append(load_nft_top + load_nft_list + load_nft_bottom);
                     if ($("#search_load_my_nfts").hasClass("d-none")) {
                        $("#load_my_nfts").removeClass("d-none");
                        $("#search_load_my_nfts").addClass("d-none");
                     } else {
                        $("#load_my_nfts").addClass("d-none");
                        $("#search_load_my_nfts").removeClass("d-none");
                     }
                     mode_selected_function();
                  }
               } catch (error) {
                  console.log(error);
               }
            }
         }
         async function search_has_nfts(contract_id_array) {
            $("#search_load_my_nfts").html(
               '<center class="reload_remove"><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
            $("#search_load_my_nfts").removeClass("d-none");
            $("#load_my_nfts").addClass("d-none");
            if (contract_id_array.length > 0) {
               for (i in contract_id_array) {
                  contract_id_search = contract_id_array[i];
                  const contract_search = new nearApi.Contract(
                     wallet.account(), // the account object that is connecting
                     contract_id_search,
                     {
                        viewMethods: ["nft_tokens_for_owner", "nft_metadata"],
                     }
                  );
                  try {
                     const response_search = await contract_search.nft_tokens_for_owner({
                        account_id: account_id,
                     });
                     if (response_search.length > 0) {
                        response_search_metadata = await contract_search.nft_metadata();
         
                        //   search_nft_array.push(response_search_metadata.name)
                        load_search_nft_top = '<h4 class="text-white">' + `(${response_search.length}) ` + response_search_metadata.name + '</h4><div class="row">';
                        load_search_nft_list = "";
                        for (i in response_search) {
                           if (i !== "sum") {
                              image_media = response_search[i].metadata.media;
                              nft_checked_title = response_search[i].metadata.title;
                              var image_url = "";
                              if (response_search_metadata.base_uri) {
                                 var image_url = response_search_metadata.base_uri + "/" + image_media;
                              } else {
                                 var image_url = image_media;
                              }
                              selected_border = "";
                              if (batch_nft_array.some((nft_obj) => nft_obj.image_url === image_url)) {
                                 selected_border = "border-selected";
                              }
         
                              load_search_nft_native = `
           	       <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card">
           	          <div class="card switch_theme select_nft_batch ${selected_border}" data-token_id="${response_search[i].token_id}" data-contract_id="${contract_id_search}"
           	          data-image_url="${image_url}"
           	          >
           	            <img class="card-img-top img-fluid" src="${image_url}"  style="width: 100%; height: 200px;
             object-fit: cover;" alt="">
           	   <div class="card-footer"  style="position: relative">
                                 <h5 class="card-title text-dark mb-0">${nft_checked_title}</h5>
                                   
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow">
                                         <div class="flex-grow">
                                          
                                           <h3 class="text-white"><a class="text-white" href="#"></a></h3>
                                           <div class="d-flex justify-content-end">
                                          <button style="position: absolute; bottom: 10px;right: 10px;"class="btn btn-dark mt-auto border-rounded btn-padding me-2 transfer_nft d-none" value="${response_search[i].token_id}" contract_id="${contract_id_search}" collection_name="${response_search_metadata.name}"  data-toggle="modal" data-target="#nft_transfer">Transfer</button></div>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                             </div>
                              </div>
           	    `;
                              load_search_nft_list = load_search_nft_list + load_search_nft_native;
                           }
                        }
                        load_search_nft_bottom = "</div>";
                        $("center").remove(".reload_remove");
                        $("#search_load_my_nfts").append(load_search_nft_top + load_search_nft_list + load_search_nft_bottom);
                        $("#load_my_nfts").addClass("d-none");
                        $("#search_load_my_nfts").removeClass("d-none");
                        mode_selected_function();
                     } else {
                        $("#search_load_my_nfts").html("<div class='text-center'><h6>This collection isn't in your wallet!</h6></div>");
                     }
                  } catch (error) {}
               }
            } else {
               $("#search_load_my_nfts").html("<div class='text-center text-dark'><h6>This collection isn't in your wallet!</h6></div>");
            }
         }
         $("#nft_message_text").keyup(function () {
            nft_message_text = $("#nft_message_text").val();
            $("#nft_message").html(nft_message_text);
         });
         $(document).on("submit", "#nft_message_form", function (e) {
            e.preventDefault();
            $("#loading_modal").modal("show");
            nft_message_text = $("#nft_message_text").val();
            message_reciever_id = $("#near_address_send").val();
            if (message_reciever_id.includes(".near") || message_reciever_id.length == 64) {
               if (confirm_access) {
                  $("#nft_message").html(nft_message_text);
                  message_theme = $("#select_message_theme").val();
                  if (message_theme == "default") {
                     $("#nft_message").attr("style", "font-size:20px; width:380px");
                  } else if (message_theme == "el-cartel" && confirm_el_cartel_check) {
                     $("#nft_message").attr("style", "font-size:20px; width:380px;padding:17px");
                  } else if (message_theme == "the-wooks" && confirm_wook) {
                     $("#nft_message").attr("style", "font-size:20px; width:380px;padding-left:17px;padding-right:17px;padding-top:30px;color:white");
                  } else if (message_theme == "near-misfits" && confirm_misfit) {
                     $("#nft_message").attr("style", "font-size:20px; width:390px;padding-left:7px;padding-right:7px;padding-top:5px;color:white");
                  }
               } else {
                  $("#nft_message").attr("style", "font-size:20px; width:380px");
               }
         
               var node = document.getElementById("nft_message_display");
         
               var options = {
                  height: 500,
                  width: 500,
                  quality: 1.0,
                  style: {
                     padding: "57px",
                     fontSize: "40px",
                     paddingTop: "40px",
                     paddingRight: "0px",
                     paddingBottom: "0px",
                  },
               };
               domtoimage.toPng(node, options).then(function (dataUrl) {
                  var blob = dataURItoBlob(dataUrl);
                  var fd = new FormData();
                  fd.append("name", "upload_image.png");
                  fd.append("image", blob); // blob file
                  fd.append("info", "Info");
                  fd.append("from", account_id);
                  fd.append("to", message_reciever_id);
                  $.ajax({
                     url: "https://nearkits.io/php/upload_nft_message.php",
                     data: fd,
                     cache: false,
                     contentType: false,
                     processData: false,
                     dataType: "JSON",
                     type: "POST",
                     success: function (data) {
                        image_link = data.image_link;
                        localStorage.setItem("image_link", image_link);
                        // window.location.href='https://nearkits.io/messages/'+image_link
                        send_nft_message(image_link, message_reciever_id);
                        $("#nft_message").removeAttr("style");
                        $("#loading_modal").modal("hide");
                     },
                  });
               });
            } else {
               toastr.warning("Invalid account address!");
               $("#nft_message").removeAttr("style");
               $("#loading_modal").modal("hide");
            }
         });
         stored_image_link = localStorage.getItem("image_link");
         if (stored_image_link) {
            0;
         }
         batch_nft_array = [];
         
         $(document).on("click", ".select_nft_batch", function (e) {
            $(this).addClass("border-selected");
            token_id = $(this).data("token_id");
            contract_id = $(this).data("contract_id");
            image_url = $(this).data("image_url");
            nft_transfer_obj = {
               contract_id: contract_id,
               token_id: token_id,
               image_url: image_url,
            };
         
            if (!batch_nft_array.some((nft_obj) => nft_obj.image_url === image_url)) {
               batch_nft_array.push(nft_transfer_obj);
            } else {
               batch_nft_array = batch_nft_array.filter((nft_obj) => nft_obj.image_url !== image_url);
               $(this).removeClass("border-selected");
            }
            if (batch_nft_array.length == 1) {
               transfer_amount = `You're about to transfer 1 NFT`;
            } else {
               transfer_amount = `You're about to transfer ${batch_nft_array.length} NFTs`;
            }
            $(".transfer_amount").html(transfer_amount);
         });
         
         async function sendTransactions() {
            const account = await near.account(account_id);
            const keypair = await new nearApi.keyStores.BrowserLocalStorageKeyStore().getKey("mainnet", account_id);
            value = $("#batch_transfer_address").val();
            if (value.includes(".near") || value.length == 64) {
               publicKey = keypair.publicKey;
               const publicKey_string = publicKey.toString();
               const { nonce, block_hash } = await near.connection.provider.query({
                  request_type: "view_access_key",
                  account_id: account_id,
                  public_key: publicKey_string,
                  finality: "optimistic",
               });
               console.log(batch_nft_array);
               batch_nft_array.forEach(function (nft) {
                  var transaction_send = new nearApi.transactions.Transaction({
                     signerId: account_id,
                     publicKey: publicKey,
                     nonce: nonce + 1,
                     receiverId: nft.contract_id,
                     blockHash: bs58.decode(block_hash),
                     actions: [
                        nearApi.transactions.functionCall(
                           "nft_transfer",
                           {
                              receiver_id: value.toLowerCase(),
                              token_id: String(nft.token_id),
                           },
                           30000000000000,
                           1
                        ),
                     ],
                  });
                  //         const serializedTx = nearApi.utils.serialize.serialize(
                  //   nearApi.transactions.SCHEMA,
                  //   transaction
                  // );
         
                  // const signedSerializedTx = bs58.encode(serializedTx);
                  transactions_array.push(transaction_send);
               });
         
               console.log(transactions_array);
               if (confirm_access) {
                  const result_1 = await wallet.requestSignTransactions({
                     transactions: transactions_array,
                  });
               }
               console.log(result_1);
            } else {
               //   toastr.warning("Invalid account address!");
            }
         }
         
         $(document).on("click", ".batch_transfer_nft_btn", function (e) {
            transactions_array = [];
            if (confirm_access) {
               sendTransactions();
            } else {
               toastr.warning("No NkT card detected!");
            }
         });
         
         function dataURItoBlob(dataURI) {
            // convert base64/URLEncoded data component to raw binary data held in a string
            var byteString;
            if (dataURI.split(",")[0].indexOf("base64") >= 0) byteString = atob(dataURI.split(",")[1]);
            else byteString = unescape(dataURI.split(",")[1]);
         
            // separate out the mime component
            var mimeString = dataURI.split(",")[0].split(":")[1].split(";")[0];
         
            // write the bytes of the string to a typed array
            var ia = new Uint8Array(byteString.length);
            for (var i = 0; i < byteString.length; i++) {
               ia[i] = byteString.charCodeAt(i);
            }
         
            return new Blob([ia], { type: mimeString });
         }
         function downloadImage(data, filename = "untitled.png") {
            var a = document.createElement("a");
            a.href = data;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
         }
         // send_nft_message()
         
         async function send_nft_message(image_link, reciever_id) {
            account_id = wallet._authData.accountId;
            try {
               const message_contract = await new nearApi.Contract(wallet.account(), "nft-message.nearkits.near", {
                  changeMethods: ["nft_mint"],
               });
               const formattedParams = {
                  token_id: image_link.replace(".png", ""),
                  metadata: {
                     title: "Nft messsage from " + account_id,
                     media: "https://nearkits.io/messages/" + image_link,
                     description: "Send NFT messsages on https://nearkits.io",
                  },
                  receiver_id: reciever_id,
               };
         
               const contract_search = new nearApi.Contract(
                  wallet.account(), // the account object that is connecting
                  "cards.nearkits.near",
                  {
                     viewMethods: ["nft_tokens_for_owner", "nft_metadata"],
                  }
               );
               const response_search_check = await contract_search.nft_tokens_for_owner({
                  account_id: account_id,
               });
               if (response_search_check.length > 0) {
                  cost = "1000000000000000000000";
               } else {
                  cost = "27000000000000000000000";
               }
         
               const ret = await message_contract.nft_mint(formattedParams, 270000000000000, cost);
            } catch (error) {
               console.log(error);
               toastr.warning("this nft can't be transferred");
            }
         }
         
         function get_staking_partners() {
            $.ajax({
               type: "POST",
               url: "https://nearkits.io/php/get_nft_staked_array.php",
               dataType: "json",
               data: {
                  account_id: account_id,
               },
               success: async function (response) {
                  near_dragons_price = response.near_dragons;
                  check_staked_nfts("stek.near", "dragonnation.near", near_dragons_price);
                  check_staked_nfts("vexedapes_staking.near", "nft1.vexedapesmint.near", response.vexed_apes);
                  check_staked_nfts("vexedapes_staking.near", "vexedapesclub.near", response.vexed_apes_2);
                  await check_staked_nfts("kokumokongz_staking_wallet.near", "kokumokongz.near", response.kokumokongz);
                  await check_staked_nfts("stake.secretskelliessociety.near", "undead.secretskelliessociety.near", response.undead);
                  await check_staked_nfts("sstake.secretskelliessociety.near", "grimms.secretskelliessociety.near", response.grimms);
                  await check_staked_nfts("stake.secretskelliessociety.near", "estates.secretskelliessociety.near", response.estates);
         
                  //     localStorage.setItem(account_id + "AllNfts", JSON.stringify(response));
                  // $(".loading_array").addClass("d-none")
         
                  //     initialize_stored_nfts(account_id)
               },
            });
         }
         
         async function check_staked_nfts(stake_contract_id, contract_id_get, show_price) {
            account_id = wallet._authData.accountId;
            if (stake_contract_id == "stek.near") {
               viewMethods = "get_staked_nfts_of_owner";
            } else if (stake_contract_id == "stake.secretskelliessociety.near") {
               viewMethods = "owner_tokens";
            } else {
               viewMethods = "get_staking_informations_by_owner_id";
            }
            const contract_stake = new nearApi.Contract(
               wallet.account(), // the account object that is connecting
               stake_contract_id,
               {
                  viewMethods: [viewMethods],
               }
            );
         
            const call_nft_token = new nearApi.Contract(
               wallet.account(), // the account object that is connecting
               contract_id_get,
               {
                  viewMethods: ["nft_metadata"],
               }
            );
            try {
               if (stake_contract_id == "stek.near") {
                  const response_staked_nfts = await contract_stake.get_staked_nfts_of_owner({
                     account_id: account_id,
                     from_index: "0",
                     limit: 100,
                  });
                  load_staked_data(response_staked_nfts, contract_id_get, show_price);
               } else if (stake_contract_id == "stake.secretskelliessociety.near") {
                  const response_staked_nfts = await contract_stake.owner_tokens({
                     account_id: account_id,
                     contract_id: contract_id_get,
                     limit: 100,
                  });
                  load_staked_data(response_staked_nfts, contract_id_get, show_price);
               } else {
                  const response_staked_nfts = await contract_stake.get_staking_informations_by_owner_id({
                     from_index: "0",
                     account_id: account_id,
                     limit: 100,
                  });
                  load_staked_data(response_staked_nfts, contract_id_get, show_price);
               }
               count_array = 1;
               check_array_og = JSON.parse(localStorage.getItem(account_id + "AllNfts")).html;
            } catch (error) {
               console.log(error);
            }
         }
         function load_staked_data(response_staked_nfts, contract_id_get, show_price) {
            if (response_staked_nfts.length > 0) {
               for (i in response_staked_nfts) {
                  token_id = response_staked_nfts[i]["token_id"];
         
                  // var image_url = "";
                  //         if (response_metadata.base_uri) {
                  //             var image_url =
                  //                 response_metadata.base_uri + "/" + image_media;
                  //         } else {
                  //             var image_url = image_media;
                  //         }
                  $.ajax({
                     type: "GET",
                     url: "https://api-v2-mainnet.paras.id/token?token_id=" + token_id + "&contract_id=" + contract_id_get,
                     dataType: "json",
                     success: function (response_data) {
                        contract_id_got = response_data.data.results[0];
                        try {
                           score = response_data.data.results[0]["metadata"]["score"].toFixed(2);
                           image_url = response_data.data.results[0]["metadata"]["media"];
         
                           staked_nft_data = {
                              title: response_data.data.results[0]["metadata"]["title"],
                              image: image_url,
                              collection: contract_id_get,
                              contract_id: contract_id_get,
                              token_id: response_data.data.results[0]["token_id"],
                              floor_price: show_price[0].toFixed(2),
                              floor_price_usd: show_price[1].toFixed(2),
                              score: score,
                              collection_id: contract_id_get,
                              is_staked: true,
                           };
                           var stored_nfts_new_array = JSON.parse(localStorage.getItem(account_id + "AllNfts"));
                           var stored_nfts_new_array_check = stored_nfts_new_array.html;
         
                           if (stored_nfts_new_array_check.filter((e) => e.token_id === response_data.data.results[0]["token_id"] && e.contract_id === contract_id_get).length > 0) {
                           } else {
                              stored_nfts_new_array_check.push(staked_nft_data);
                              store_array = {
                                 html: stored_nfts_new_array_check,
                                 nfts_count: stored_nfts_new_array_check.length,
                              };
                              localStorage.setItem(account_id + "AllNfts", JSON.stringify(store_array));
                           }
         
                           const nft_index = stored_nfts_new_array_check.findIndex((e) => e.token_id === response_data.data.results[0]["token_id"] && e.contract_id === contract_id_get);
         
                           if (nft_index > -1) {
                              stored_nfts_new_array_check[nft_index] = staked_nft_data;
                              store_array = {
                                 html: stored_nfts_new_array_check,
                                 nfts_count: stored_nfts_new_array_check.length,
                              };
                              localStorage.setItem(account_id + "AllNfts", JSON.stringify(store_array));
                           }
                           count_array = count_array + 1;
                           if (!(check_array_og == stored_nfts_new_array_check)) {
                              initialize_stored_nfts(account_id);
                           }
         
                           start(0, account_id);
                        } catch (error) {
                           console.log(error);
                        }
                     },
                  });
               }
            }
         }
         message_alert_count = 0;
         async function check_has_messages() {
            account_id = wallet._authData.accountId;
         
            message_contract_id = "nft-message.nearkits.near";
            const check_message_contract = new nearApi.Contract(
               wallet.account(), // the account object that is connecting
               message_contract_id,
               {
                  viewMethods: ["nft_tokens_for_owner", "nft_metadata"],
               }
            );
            try {
               const message_response_check = await check_message_contract.nft_tokens_for_owner({
                  account_id: account_id,
               });
               message_response = message_response_check.reverse();
         
               if (message_response.length > 0) {
                  const message_response_metadata = await check_message_contract.nft_metadata();
                  //   search_nft_array.push(response_metadata.name)
                  // contract_id_array_input.push(contract_id)
                  nft_title = message_response_metadata.name.toUpperCase();
                  // nft_object_array.push({
                  //     contract_id: contract_id,
                  //     nft_title: nft_title
                  // });
         
                  load_nft_message_top = '<h4 class="text-white">' + message_response_metadata.name + '</h4><div class="row">';
                  load_nft_message_list = "";
                  for (i in message_response) {
                     if (i !== "sum") {
                        message_image_media = message_response[i].metadata.media;
                        message_nft_checked_title = message_response[i].metadata.title;
                        message_token_id = message_response[i].token_id;
                        await $.ajax({
                           url: "https://nearkits.io/php/get_message_info.php",
                           method: "POST",
                           dataType: "json",
                           data: {
                              message_id: message_token_id,
                              account_id: account_id,
                           },
                           success: function (responseData) {
                              message_timestamp = responseData.message_timestamp;
                              message_timestamp_format = responseData.message_timestamp_format;
                              link_status = responseData.link_status;
                              red_alert = "";
                              if (link_status == "active") {
                                 message_alert_count = message_alert_count + 1;
                                 red_alert = `<span id="${message_token_id}_red_alert" class="red_alert bg-danger"></span>`;
                              }
                              load_nft__message_native = `
           	       <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card">
         
           	          <div class="card message_card switch_theme message_display_modal" data-id="${message_token_id}" data-image="${message_image_media}" data-from_user="${message_nft_checked_title.replace(
                                 "Nft messsage",
                                 ""
                              )}" data-message_timestamp="${message_timestamp}">
           	            <img class="card-img-top img-fluid" src="${message_image_media}"  style="width: 100%; height: 150px;
             object-fit: contain;" alt="">
           	    <div class="card-footer message_card p-1 text-center">
                               
                                   <div class="card-title text-dark mb-0 d-flex justify-content-center" style="font-size:12px">${red_alert}   <h5 class="card-title text-dark mb-0">${message_nft_checked_title.replace(
                                 "Nft messsage",
                                 ""
                              )}</h5></div>
                                   <p class="card-title text-dark" style="margin-left: 0.5rem;">${message_timestamp_format}</p>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow">
                                         <div class="flex-grow">
                                          
                                           <h3 class="text-white"><a class="text-white" href="#"></a></h3>
                                           <div class="d-flex justify-content-end">
                                          <button class="btn btn-dark border-rounded btn-padding me-2  d-none transfer_nft" value="${message_token_id}" contract_id="${message_contract_id}" collection_name="${
                                 message_response_metadata.name
                              }">Delete</button></div>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               </div>
                             </div>
                  
                              </div>
                          
           	    `;
                              load_nft_message_list = load_nft_message_list + load_nft__message_native;
                           },
                        });
                     }
                  }
                  if (message_alert_count > 0) {
                     $("#message_alert_count").html(message_alert_count);
                     $("#message_alert_count").removeClass("d-none");
                  }
         
                  load_nft_message_bottom = "</div>";
                  $("center").remove(".reload_remove_message");
                  $(".display_messages").append(load_nft_message_top + load_nft_message_list + load_nft_message_bottom);
                  if ($("#search_load_my_nfts").hasClass("d-none")) {
                     $(".display_messages").removeClass("d-none");
                     $("#search_load_my_nfts").addClass("d-none");
                  } else {
                     $(".display_messages").addClass("d-none");
                     $("#search_load_my_nfts").removeClass("d-none");
                  }
                  mode_selected_function();
               }
            } catch (error) {
               console.log(error);
            }
         }
         // async function search_has_nfts(contract_id_array) {
         //     $("#search_load_my_nfts").html('<center class="reload_remove"><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>');
         //     $("#search_load_my_nfts").removeClass("d-none")
         //     $("#load_my_nfts").addClass("d-none")
         //     if (contract_id_array.length > 0) {
         //         for (i in contract_id_array) {
         //             contract_id_search = contract_id_array[i]
         //             const contract_search = new nearApi.Contract(
         //                 wallet.account(), // the account object that is connecting
         //                 contract_id_search, {
         //                     viewMethods: ['nft_tokens_for_owner', 'nft_metadata']
         //                 }
         //             )
         //             try {
         //                 const response_search = await contract_search.nft_tokens_for_owner({
         //                     account_id: account_id
         //                 });
         //                 if (response_search.length > 0) {
         
         //                     response_search_metadata = await contract_search.nft_metadata();
         
         //                     //   search_nft_array.push(response_search_metadata.name)
         //                     load_search_nft_top = '<h4 class="text-white">' + response_search_metadata.name + '</h4><div class="row">'
         //                     load_search_nft_list = ''
         //                     for (i in response_search) {
         //                         load_search_nft = `
         //   	       <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card">
         //   	          <div class="card switch_theme">
         //   	            <img class="card-img-top img-fluid" src="${response_search_metadata.base_uri+'/'+response_search[i].metadata.media}"  style="width: 100%;
         //     object-fit: cover;" alt="">
         //   	    <div class="card-footer">
         //                         <h4 class="card-title text-dark mb-0">${response_search[i].metadata.title}</h4>
         
         //                         <div class="d-flex py-4">
         //                           <div class="preview-list w-100">
         //                             <div class="preview-item p-0">
         //                               <div class="preview-item-content d-flex flex-grow">
         //                                 <div class="flex-grow">
         
         //                                   <h3 class="text-white"><a class="text-white" href="#"></a></h3>
         //                                   <div class="d-flex justify-content-end">
         //                                  <button class="btn btn-dark border-rounded btn-padding me-2  transfer_nft" value="${response_search[i].token_id}" contract_id="${contract_id_search}" collection_name="${response_search_metadata.name}"  data-toggle="modal" data-target="#nft_transfer">Transfer</button></div>
         //                                 </div>
         //                               </div>
         //                             </div>
         //                           </div>
         //                         </div>
         //                       </div>
         //                     </div>
         //                      </div>
         
         //   	    `;
         //                         load_search_nft_list = load_search_nft_list + load_search_nft
         //                     }
         //                     load_search_nft_bottom = '</div>'
         //                     $("center").remove(".reload_remove")
         //                     $("#search_load_my_nfts").append(load_search_nft_top + load_search_nft_list + load_search_nft_bottom)
         //                     $("#load_my_nfts").addClass("d-none")
         //                     $("#search_load_my_nfts").removeClass("d-none")
         //                     mode_selected_function()
         
         //                 } else {
         //                     $("#search_load_my_nfts").html("<div class='text-center'><h6>This collection isn't in your wallet!</h6></div>");
         //                 }
         
         //             } catch (error) {
         
         //             }
         //         }
         //     } else {
         //         $("#search_load_my_nfts").html("<div class='text-center text-dark'><h6>This collection isn't in your wallet!</h6></div>");
         //     }
         // }
         $(document).on("click", ".message_display_modal", function () {
            $("#message_display_modal_image").attr("src", $(this).data("image"));
            $("#from_user").html($(this).data("from_user"));
            $("#message_timestamp").html($(this).data("message_timestamp"));
            $("#message_display_modal").modal("show");
            $("#" + $(this).data("id") + "_red_alert").addClass("d-none");
            $("#delete_message").attr("data-id", $(this).data("id"));
            $("#reply_message").attr("data-to_user", $(this).data("from_user").replace(" from ", ""));
            $.ajax({
               url: "https://nearkits.io/php/update_message_status.php",
               method: "POST",
               data: {
                  account_id: account_id,
                  message_id: $(this).data("id") + ".png",
               },
               success: function (responseData) {
                  $("#" + $(this).data("id") + "_red_alert").addClass("d-none");
                  message_alert_count = message_alert_count - 1;
                  if (responseData == "updated") {
                     if (message_alert_count > 0) {
                        $("#message_alert_count").html(message_alert_count);
                        $("#message_alert_count").removeClass("d-none");
                     } else {
                        $("#message_alert_count").addClass("d-none");
                     }
                  }
               },
            });
         });
         $(document).on("click", "#delete_message", function () {
            delete_messages($(this).data("id"));
         });
         $(document).on("click", "#reply_message", function () {
            $("#message_display_modal").modal("hide");
            $("#near_address_send").val($(this).data("to_user"));
            $(".nav_select").removeClass("active");
            $("#send_nft_message_nav").addClass("active");
            $(".display_panel").addClass("d-none");
            $("#send_nft_message").removeClass("d-none");
         });
         
         function confirm_el_cartel(contract_check) {
            account_id = wallet._authData.accountId;
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&contract_id=" + contract_check,
               dataType: "json",
               success: function (response_data) {
                  if (response_data.data.results.length > 0) {
                     $(".el-cartel").prop("disabled", false);
                     confirm_el_cartel_check = true;
                  } else {
                     $(".el-cartel").prop("disabled", true);
                     if (!(contract_check == "cartel.neartopia.near")) {
                        confirm_el_cartel("cartel.neartopia.near");
                     }
         
                     confirm_el_cartel_check = false;
                  }
               },
            });
         }
         
         function confirm_the_wooks(contract_check) {
            account_id = wallet._authData.accountId;
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&creator_id=" + contract_check,
               dataType: "json",
               success: function (response_data) {
                  if (response_data.data.results.length > 0) {
                     $(".the-wooks").prop("disabled", false);
                     confirm_wook = true;
                  } else {
                     $(".the-wooks").prop("disabled", true);
                     confirm_wook = false;
                  }
               },
            });
         }
         function confirm_the_misfits(contract_check) {
            account_id = wallet._authData.accountId;
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&creator_id=" + contract_check,
               dataType: "json",
               success: function (response_data) {
                  if (response_data.data.results.length > 0) {
                     $(".near-misfits").prop("disabled", false);
                     confirm_misfit = true;
                  } else {
                     $(".near-misfits").prop("disabled", true);
                     confirm_misfit = false;
                  }
               },
            });
         }
             function confirm_the_asac(contract_check) {
            account_id = wallet._authData.accountId;
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&creator_id=" + contract_check,
               dataType: "json",
               success: function (response_data) {
                  if (response_data.data.results.length > 0) {
                    $(`.select_gallery_theme[value='asac_nft']`).prop("disabled", false);
            
                  } else {
                   $(`.select_gallery_theme[value='asac_nft']`).prop("disabled", false);
                  }
               },
            });
         }
         
         function confirm_access_card() {
            account_id = wallet._authData.accountId;
         
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&contract_id=cards.nearkits.near",
               dataType: "json",
               success: function (response_data) {
                      $(".account_address").removeClass("d-none")
                   $("#copy_address").val("https://nearkits.io/gallery/" + account_id)
                  if (response_data.data.results.length > 0) {
                     $(".el-cartel").prop("disabled", false);
                     confirm_access = true;
                  } else {
                     $(".el-cartel").prop("disabled", true);
                     confirm_access = false;
                  }
               },
            });
         }
         
         function select_custom_message() {
            message_theme = $("#select_message_theme").val();
            $("#nft_message").css("color", "black");
            if (message_theme == "default") {
               $(".image_message").css("background-image", "url(https://nearkits.io/assets/images/nearkits-message.png)");
               $(".image_message").css("padding", "0.3rem 2rem");
            } else if (message_theme == "el-cartel") {
               $(".image_message").css("background-image", "url(https://nearkits.io/assets/images/el-cartel-message-1.png)");
               $(".image_message").css("padding", "0.3rem 3rem");
            } else if (message_theme == "the-wooks") {
               $(".image_message").css("background-image", "url(https://nearkits.io/assets/images/wooks-message.png)");
               $(".image_message").css("padding", "2rem 2rem");
               $("#nft_message").css("color", "white");
            } else if (message_theme == "near-misfits") {
               $(".image_message").css("background-image", "url(https://nearkits.io/assets/images/misfits-message.jpg)");
               $(".image_message").css("padding", "0.2rem 2rem");
               $("#nft_message").css("color", "white");
            }
         }
         $("#select_message_theme").on("change", function () {
            select_custom_message();
         });
         
         async function delete_messages(token_id) {
            try {
               const contract = await new nearApi.Contract(wallet.account(), "nft-message.nearkits.near", {
                  changeMethods: ["nft_transfer"],
               });
               const formattedParams = {
                  token_id: token_id,
                  receiver_id: "delete-message.nearkits.near",
               };
         
               const ret = await contract.nft_transfer(formattedParams, 270000000000000, "1");
            } catch (error) {
               toastr.warning("this nft can't be transferred");
            }
         }
         
         $(document).on("click", ".close_modal", function () {
            $("#display_nft_info_modal").modal("hide");
            $("#message_display_modal").modal("hide");
            $("#batch_nft_list").modal("hide");
         });
         nft_offer_obj_array = [];
         $(document).on("click", ".display_nft_info", function () {
            $("#nft_display_modal_image").attr("src", $(this).data("image"));
            $("#nft_modal_title").html($(this).data("title"));
            $("#nft_modal_floor_price").html($(this).data("floor_price"));
            $("#nft_modal_floor_price_usd").html($(this).data("floor_price_usd"));
            $("#nft_modal_score").html($(this).data("score"));
            $("#display_nft_attributes").html("");
            $(".nft_modal_footer").html("");
            token_id = $(this).data("token_id");
            contract_id = $(this).data("contract_id");
            staked_link = $(this).data("staked_link");
            type = $(this).data("type");
            $.ajax({
               type: "GET",
               url: "https://api-v2-mainnet.paras.id/token?token_id=" + token_id + "&contract_id=" + contract_id,
               dataType: "json",
               success: function (response_data) {
                  attributes = response_data.data.results[0].metadata.attributes;
                  console.log(attributes);
                  for (i in attributes) {
                     if (i !== "sum") {
                        load_attribute = `
                         <div class="col-6 mt-2">
                         <div class="theme-white-bg border-rounded p-2">
                                   <h5 id="total_floor" class="mb-0 reload_divs text-white">${attributes[i].trait_type}</h5>
                                 <p class="ml-auto font-weight-light usd_show text-dark mb-0" id="usd_near_floor">${attributes[i].value}</p>
                                 </div>
                                 </div>`;
         
                        $("#display_nft_attributes").append(load_attribute);
                     }
                  }
                  mode_selected_function();
                  if (type !== "get_nfts") {
                     if (staked_link !== "") {
                        $(".nft_modal_footer").append(` <a class="btn btn-dark border-rounded btn-padding transfer_nft me-2" href="${staked_link}">Staked</a>`);
                     } else {
                        $(".nft_modal_footer").append(
                           `<button class="btn btn-dark border-rounded btn-padding transfer_nft me-2" value="${token_id}" contract_id="${contract_id}" collection_name="${contract_id}" data-toggle="modal" data-target="#nft_transfer">Transfer</button>      `
                        );
                     }
                  }
                  // $(".nft_modal_footer").append(`<button class="btn btn-dark border-rounded btn-padding transfer_nft me-2" value="${token_id}" contract_id="${contract_id}" collection_name="${contract_id}" data-toggle="modal" data-target="#nft_transfer">Transfer</button>      `)
                  $("#display_nft_info_modal").modal("show");
               },
            });
         });
         $(".search_collection_form").submit(function (e) {
             e.preventDefault()
            $("#load_search_collection").html(
               '<center><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
         
            search_collection_paras = $("#search_collection_paras").val();
            $.ajax({
               url: "https://api-v2-mainnet.paras.id/collections?collection_search=" + search_collection_paras,
               method: "GET",
               success: function (responseData) {
                  search_results = responseData.data.results;
                  $("#load_search_collection").html("");
                  nft_offer_obj_array = [];
                  for (i in search_results) {
                     if (i != "sum") {
                        if (search_results[i].isCreator == true) {
                           load_badge = '<i class="mdi mdi-marker-check"></i>';
                        } else {
                           load_badge = "";
                        }
                        load_search_collection = `
                              <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card display_collection_info" style="text-decoration: none;" href="#display_collection_info"
                             data-collection_id="${search_results[i].collection_id}"
                             >
                             <a  style="text-decoration: none;" href="#display_collection_info">
                             <div class="card switch_theme">
                              <img class="card-img-top img-fluid" src="https://paras-cdn.imgix.net/${search_results[i].media}?w=800&auto=format,compress" style="width:100% ; height: 200px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2">
                                 <h5 class="card-title text-white">${search_results[i].collection} ${load_badge}</h5>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow p-0">
                                         <div class="flex-grow">
                                           <div class="d-flex d-md-flex d-xl-flex justify-content-start">
                                           </div>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               
                             </div>
                             </a>
                           </div>
                             `;
                        $("#load_search_collection").append(load_search_collection);
                     }
                  }
               },
            });
         });
         $(document).on("click", ".display_collection_info", function () {
            collection_id = $(this).data("collection_id");
            $("#load_search_collection").html("");
            $.ajax({
               url: `https://api-v2-mainnet.paras.id/token-series?contract_id=${collection_id}&__limit=100&__sort=lowest_price::1`,
               method: "GET",
               success: function (responseData) {
                  search_results = responseData.data.results;
                  if (search_results.length > 0) {
                     $("#load_search_collection").html("");
                     for (i in search_results) {
                        if (i != "sum") {
                           load_search_collection = `
                              <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card " style="text-decoration: none;
                             >
                             <a  style="text-decoration: none;" class="">
                             <div class="card switch_theme select_offer_batch" "
                             data-contract_id="${search_results[i].contract_id}"
                             data-token_id="${search_results[i].token_series_id}"
                             data-image_url="${search_results[i].metadata.media}">
                              <img class="card-img-top img-fluid" src="${search_results[i].metadata.media}" style="width:100% ; height: 200px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2">
                                 <h5 class="card-title text-white">${search_results[i].metadata.title}</h5>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow p-0">
                                         <div class="flex-grow">
                                           <div class="d-flex d-md-flex d-xl-flex justify-content-start">
                                           <div class="d-block">
                                             <p class="text-white text-small">Floor price: ${(search_results[i].lowest_price / 1000000000000000000000000).toFixed(2)} </p>
                                                                                 <p class="text-white text-small">Rarity: ${search_results[i].metadata.score.toFixed(2)} </p>
                                           </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               
                             </div>
                             </a>
                           </div>
                             `;
                           $("#load_search_collection").append(load_search_collection);
                           mode_selected_function();
                        }
                     }
                  } else {
                     $("#load_search_collection").html("<h5>No collection found</h5>");
                  }
               },
            });
         });
         
         $(document).on("click", ".select_offer_batch", function (e) {
            $(this).addClass("border-selected");
            token_id = $(this).data("token_id");
            contract_id = $(this).data("contract_id");
            image_url = $(this).data("image_url");
            nft_offer_obj = {
               contract_id: contract_id,
               token_id: token_id,
               image_url: image_url,
            };
            if (!nft_offer_obj_array.some((nft_obj) => nft_obj.image_url === image_url)) {
               nft_offer_obj_array.push(nft_offer_obj);
            } else {
               nft_offer_obj_array = nft_offer_obj_array.filter((nft_obj) => nft_obj.image_url !== image_url);
               $(this).removeClass("border-selected");
            }
            if (nft_offer_obj_array.length == 1) {
               bid_amount = `You're about to Bid for 1 NFT`;
            } else {
               bid_amount = `You're about to Bid for ${nft_offer_obj_array.length} NFTs`;
            }
            $(".bid_amount").html(bid_amount);
         });
         
         $("#bid_amount_input").keyup(function () {
            bid_cost = `This will cost ${($(this).val() * nft_offer_obj_array.length).toFixed(2)}  +  ${String(0.00859 * nft_offer_obj_array.length)} to store`;
            $(".bid_cost").html(bid_cost);
         });
         $(document).on("click", ".batch_bid_nft_btn", function (e) {
            nft_offer_obj_array_transaction = [];
            if (confirm_access) {
               sendOffers();
            } else {
               toastr.warning("No NkT card detected!");
            }
         });
         nft_offer_obj_array_transaction = [];
         async function sendOffers() {
            const account = await near.account(account_id);
            const keypair = await new nearApi.keyStores.BrowserLocalStorageKeyStore().getKey("mainnet", account_id);
            publicKey = keypair.publicKey;
            const publicKey_string = publicKey.toString();
            const { nonce, block_hash } = await near.connection.provider.query({
               request_type: "view_access_key",
               account_id: account_id,
               public_key: publicKey_string,
               finality: "optimistic",
            });
            bid_cost_send = nearApi.utils.format.parseNearAmount($("#bid_amount_input").val());
            var storage_deposit = new nearApi.transactions.Transaction({
               signerId: account_id,
               publicKey: publicKey,
               nonce: nonce + 1,
               receiverId: "marketplace.paras.near",
               blockHash: bs58.decode(block_hash),
               actions: [
                  nearApi.transactions.functionCall(
                     "storage_deposit",
                     {
                        account_id: String(account_id),
                     },
                     27000000000000,
                     nearApi.utils.format.parseNearAmount(String(0.00859 * nft_offer_obj_array.length))
                  ),
               ],
            });
            nft_offer_obj_array_transaction.push(storage_deposit);
            nft_offer_obj_array.forEach(function (nft) {
               var transaction_offer_send = new nearApi.transactions.Transaction({
                  signerId: account_id,
                  publicKey: publicKey,
                  nonce: nonce + 1,
                  receiverId: "marketplace.paras.near",
                  blockHash: bs58.decode(block_hash),
                  actions: [
                     nearApi.transactions.functionCall(
                        "add_offer",
                        {
                           nft_contract_id: String(nft.contract_id),
                           token_id: String(nft.token_id),
                           ft_token_id: "near",
                           price: bid_cost_send,
                        },
                        27000000000000,
                        bid_cost_send
                     ),
                  ],
               });
         
               nft_offer_obj_array_transaction.push(transaction_offer_send);
            });
         
            if (confirm_access) {
               const result_1 = await wallet.requestSignTransactions({
                  transactions: nft_offer_obj_array_transaction,
               });
            }
            console.log(result_1);
         }
         $(".show_my_offers").on("click", function () {
            $(".bid_search_sub").addClass("d-none");
            $(".my_offers_sub").removeClass("d-none");
            $(this).addClass("btn-dark");
            $(this).removeClass("btn-outline-dark");
            $(".show_search_bids").removeClass("btn-dark");
            $(".show_search_bids").addClass("btn-outline-dark");
            load_my_offers();
         });
         $(".show_search_bids").on("click", function () {
            $(".my_offers_sub").addClass("d-none");
            $(".bid_search_sub").removeClass("d-none");
            $(this).addClass("btn-dark");
            $(this).removeClass("btn-outline-dark");
            $(".show_my_offers").removeClass("btn-dark");
            $(".show_my_offers").addClass("btn-outline-dark");
         });
         async function load_offer_storage_info() {
            try {
               const contract_check = await new nearApi.Contract(wallet.account(), "marketplace.paras.near", {
                  viewMethods: ["storage_balance_of"],
                  changeMethods: ["storage_deposit ", "register_tokens "],
               });
         
               const ret = await contract_check.storage_balance_of({
                  account_id: account_id,
               });
               storage_used = `You're using ${nearApi.utils.format.formatNearAmount(ret)}  to store`;
               $(".storage_used").html(storage_used);
            } catch (error) {}
         }
         function load_my_offers() {
            offer_object_array = [];
            $.ajax({
               type: "GET",
               url: `https://api-v2-mainnet.paras.id/offers?buyer_id=${account_id}`,
               dataType: "json",
               success: function (response_data) {
                  search_results = response_data.data.results;
                  $("#load_my_offers").html("");
                  if (search_results.length > 0) {
                     for (check in search_results) {
                        if (check != "sum") {
                           offer_contract_id = search_results[check].contract_id;
                           offer_token_id = search_results[check].token_id;
                           offer_price = search_results[check].price;
                           offer_object = {
                              offer_contract_id: offer_contract_id + offer_token_id,
                              offer_price: offer_price,
                           };
                           offer_object_array.push(offer_object);
         
                           $.ajax({
                              url: `https://api-v2-mainnet.paras.id/token?token_id=${offer_token_id}&contract_id=${offer_contract_id}`,
                              method: "GET",
                              success: function (responseData) {
                                 search_results = responseData.data.results;
                                 console.log(offer_object_array);
                                 for (i in search_results) {
                                    if (i != "sum") {
                                       let offer_array = offer_object_array.filter((check) => check["offer_contract_id"] === search_results[i].contract_id + search_results[i].token_series_id);
                                       load_search_collection = `
                              <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card " style="text-decoration: none;
                             >
                             <a  style="text-decoration: none;" class="">
                             <div class="card switch_theme select_delete_batch" "
                             data-contract_id="${search_results[i].contract_id}"
                             data-token_id="${search_results[i].token_series_id}"
                             data-image_url="${search_results[i].metadata.media}">
                              <img class="card-img-top img-fluid" src="${search_results[i].metadata.media}" style="width:100% ; height: 200px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2">
                                 <h5 class="card-title text-white">${search_results[i].metadata.title}</h5>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow p-0">
                                         <div class="flex-grow">
                                           <div class="d-flex d-md-flex d-xl-flex justify-content-start">
                                           <div class="d-block">
                                             <p class="text-white text-small">Offer: ${(offer_array[0].offer_price / 1000000000000000000000000).toFixed(2)} </p>
                                                                                 <p class="text-white text-small">Rarity: ${search_results[i].metadata.score.toFixed(2)} </p>
                                           </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               
                             </div>
                             </a>
                           </div>
                             `;
                                       $("#load_my_offers").append(load_search_collection);
                                       mode_selected_function();
                                    }
                                 }
                              },
                           });
                        }
                     }
                  } else {
                     alert();
                     $("#load_my_offers").html("<h5 class=''>No offers made yet!</h5>");
                  }
               },
            });
         }
         nft_delete_offer_obj_array = [];
         $(document).on("click", ".select_delete_batch", function (e) {
            $(this).addClass("border-selected-red");
            token_id = $(this).data("token_id");
            contract_id = $(this).data("contract_id");
            image_url = $(this).data("image_url");
            nft_offer_obj = {
               contract_id: contract_id,
               token_id: token_id,
               image_url: image_url,
            };
            if (!nft_delete_offer_obj_array.some((nft_obj) => nft_obj.image_url === image_url)) {
               nft_delete_offer_obj_array.push(nft_offer_obj);
            } else {
               nft_delete_offer_obj_array = nft_delete_offer_obj_array.filter((nft_obj) => nft_obj.image_url !== image_url);
               $(this).removeClass("border-selected-red");
            }
            //   if(nft_delete_offer_obj_array.length == 1){
            //         bid_amount = `You're about to cancel your Bid for 1 NFT`
            //     }else{
            //         bid_amount = `You're about to cancel your Bid for ${nft_delete_offer_obj_array.length} NFTs`
            //     }
            //     $(".bid_amount").html(bid_amount)
         });
         $(document).on("click", ".cancel_offers", function (e) {
            nft_cancel_offer_obj_array_transaction = [];
            if (confirm_access) {
               cancelOffers();
            } else {
               toastr.warning("No NkT card detected!");
            }
         });
         async function cancelOffers() {
            const account = await near.account(account_id);
            const keypair = await new nearApi.keyStores.BrowserLocalStorageKeyStore().getKey("mainnet", account_id);
            publicKey = keypair.publicKey;
            const publicKey_string = publicKey.toString();
            const { nonce, block_hash } = await near.connection.provider.query({
               request_type: "view_access_key",
               account_id: account_id,
               public_key: publicKey_string,
               finality: "optimistic",
            });
            bid_cost_send = nearApi.utils.format.parseNearAmount($("#bid_amount_input").val());
            var storage_deposit = new nearApi.transactions.Transaction({
               signerId: account_id,
               publicKey: publicKey,
               nonce: nonce + 1,
               receiverId: "marketplace.paras.near",
               blockHash: bs58.decode(block_hash),
               actions: [
                  nearApi.transactions.functionCall(
                     "storage_withdraw",
                     {
                        account_id: String(account_id),
                     },
                     27000000000000,
                     "1"
                  ),
               ],
            });
            nft_cancel_offer_obj_array_transaction.push(storage_deposit);
            nft_delete_offer_obj_array.forEach(function (nft) {
               var transaction_offer_send = new nearApi.transactions.Transaction({
                  signerId: account_id,
                  publicKey: publicKey,
                  nonce: nonce + 1,
                  receiverId: "marketplace.paras.near",
                  blockHash: bs58.decode(block_hash),
                  actions: [
                     nearApi.transactions.functionCall(
                        "delete_offer",
                        {
                           nft_contract_id: String(nft.contract_id),
                           token_id: String(nft.token_id),
                           ft_token_id: "near",
                           price: bid_cost_send,
                        },
                        27000000000000,
                        "1"
                     ),
                  ],
               });
         
               nft_cancel_offer_obj_array_transaction.push(transaction_offer_send);
            });
         
            if (confirm_access) {
               const result_1 = await wallet.requestSignTransactions({
                  transactions: nft_cancel_offer_obj_array_transaction,
               });
            }else{
                toastr.warning("No NkT card detected!");
            }
            console.log(result_1);
         }
         load_entire_collection_array = []
         load_entire_collection()
         
         function load_entire_collection(){
            //  account_id = "thecryptoasian.near"
              $.ajax({
               url: "https://nearkits.io/php/get_nft_collection_array.php",
               method: "POST",
               data: {
                  account_id: account_id
               },
               dataType:"json",
               success: function (responseData) {
                    search_results_array = responseData.html
                    search_results_array_unlisted = responseData.html
                    search_results_array = search_results_array.filter(data => data.has_price == null);
                    search_listed_results = search_results_array_unlisted.filter(data => data.has_price === true);
                    load_entire_collection_array_function(search_results_array)
                    load_entire_listed_collection_array_function(search_listed_results)
               },
            });
         }
         $(".show_unlisted_nfts").on("click", function () {
            $(".listed_nfts").addClass("d-none");
            $(".unlisted_nfts").removeClass("d-none");
            $(this).addClass("btn-dark");
            $(this).removeClass("btn-outline-dark");
            $(".show_listed_nfts").removeClass("btn-dark");
            $(".show_listed_nfts").addClass("btn-outline-dark");
            $(".batch_list_nft_btn").attr("data-type","list")
         }); 
         $(".show_listed_nfts").on("click", function () {
            $(".unlisted_nfts").addClass("d-none");
            $(".listed_nfts").removeClass("d-none");
            $(this).addClass("btn-dark");
            $(this).removeClass("btn-outline-dark");
            $(".show_unlisted_nfts").removeClass("btn-dark");
            $(".show_unlisted_nfts").addClass("btn-outline-dark");
             $(".batch_list_nft_btn").attr("data-type","update")
         });
         async function load_entire_collection_array_function(search_results_array){
            load_entire_collection_array = []
             for (var i=0; i < search_results_array.length; i++) {
                       if(search_results_array[i].contract_id == "x.paras.near"){
                           collection_found = search_results_array[i].collection
                       }else{
                    // const response_collection_name = await fetch(`https://api-v2-mainnet.paras.id/collections?collection_id=${search_results_array[i].contract_id}`);
                    // const response_data_name = await response_collection_name.json();
                    // collection_found = response_data_name.data.results[0].collection
                           collection_found = search_results_array[i].contract_id
                       }
                       unlisted_nft_obj_array = {
                               collection:collection_found,
                               list_array:[search_results_array[i]],
                               no_nfts:1
                           }
                        const index = load_entire_collection_array.findIndex(object => {
                            return object.collection === collection_found;
                            });
                            if(index !== -1){
                                load_entire_collection_array[index] = {
                                    collection:collection_found,
                               list_array:[...load_entire_collection_array[index].list_array, ...[search_results_array[i]]],
                                no_nfts:[...load_entire_collection_array[index].list_array, ...[search_results_array[i]]].length
                                    
                                }
                            }else{
                               load_entire_collection_array.push(unlisted_nft_obj_array) 
                            }
                           
                   }
                   load_entire_collection_array.sort((a, b) => parseFloat(b.no_nfts) - parseFloat(a.no_nfts));
                   load_collection_into_html(load_entire_collection_array,1,10)
         }
         async function load_collection_into_html(load_entire_collection_array,currPage, pageSize){
            
           $(".unlisted_nfts").html("")
           start_array = (currPage - 1) * pageSize;
           end = currPage * pageSize;
          load_entire_collection_array_row = load_entire_collection_array
             for (var i=0; load_entire_collection_array_row.length; i++) {
                   if(load_entire_collection_array_row[i].list_array[0].metadata.collection_id){
                 collection_id = load_entire_collection_array_row[i].list_array[0].metadata.collection_id
             }else{
                 collection_id = load_entire_collection_array_row[i].list_array[0].metadata.creator_id
             }
             const response_collection = await fetch(`https://api-v2-mainnet.paras.id/collection-stats?collection_id=${collection_id}`);
            const response_data = await response_collection.json();
                    unlisted_image_url = load_entire_collection_array_row[i].list_array[0].image
             unlisted_collection= load_entire_collection_array_row[i].collection
             unlisted_creator_id= load_entire_collection_array_row[i].list_array[0].metadata.creator_id
             unlisted_collection_array_count = load_entire_collection_array_row[i].list_array.length
                   floor_price = response_data.data.results.floor_price / 1000000000000000000000000
                    load_search_collection_top = `
                    <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md">
                           <img src="${unlisted_image_url}" class="img-fluid border-rounded image_listed" style="height:auto; width:100%; object-fit: cover;">
                            </div>
                            <div class="col-xs-12 col-md-9">
                            <h5 class="text-white mt-2">${unlisted_collection}</>
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg">
                                  <p class="mb-0  text-white">Nfts:</p>
                                     <h5 class="mb-0  text-white">${unlisted_collection_array_count}</h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Floor Price:</p>
                                     <h5 class="mb-0  text-white">${floor_price.toFixed(2)}  </h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Total Fp:</p>
                                     <h5 class="mb-0  text-white">${(unlisted_collection_array_count*floor_price).toFixed(2)}   </h5>
                                  </div>
                                  </div>
                               </div>
                              
                            </div>
                             <div class="col-xs-12 col-md" >
                               <button data-toggle="collapse" data-target="#collapse-${unlisted_creator_id}" aria-expanded="false" aria-controls="collapse-${unlisted_creator_id}" class="btn btn-lg mt-xs-3 btn-dark border-rounded btn_switch btn-padding me-2 switch_theme w-100 mat_top">Show Nfts</button>
                               </div>
                            </div>
                             
                        </div>
                  <div class="collapse" id="collapse-${unlisted_creator_id}">
                    <div class="card card-body switch_theme p-2 mt-2">
                    <div class="row">
                  `
                  list_collection_array = load_entire_collection_array_row[i].list_array
                  load_unlisted_nft_check = ""
                  for (var index_search=0; index_search < list_collection_array.length; index_search++) {
                      load_unlisted_nft_image_check= load_entire_collection_array_row[i].list_array[index_search].image
                      var royalty_array = Object.values(load_entire_collection_array_row[i].list_array[index_search].royalty);
                      load_unlisted_nft_royalty = 0 
                      for(obj_royalty in royalty_array){
                          if(obj_royalty!="sum"){
                          load_unlisted_nft_royalty = load_unlisted_nft_royalty+ parseFloat(royalty_array[obj_royalty]) 
                          }
                      }
                      load_search_collection_nft = await  `
                    <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card " style="text-decoration: none;"
                             >
                             <div class="card switch_theme " >
                              <img class="card-img-top img-fluid select_list_batch" 
                              data-contract_id="${load_entire_collection_array_row[i].list_array[index_search].contract_id}" data-token_id="${load_entire_collection_array_row[i].list_array[index_search].token_id}" 
                              data-image_url="${load_entire_collection_array_row[i].list_array[index_search].image}"
                              data-royalty="${load_unlisted_nft_royalty}"
                              data-toggle="collapse" data-target="#collapse-${load_unlisted_nft_image_check}" aria-expanded="false" aria-controls="collapse-${load_unlisted_nft_image_check}"  src="${load_entire_collection_array_row[i].list_array[index_search].image}" style="width:100% ; height: 100px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2 ">
                                 <h5 class="card-title text-white">${load_entire_collection_array_row[i].list_array[index_search].metadata.title}</h5>
                               
                               <div class="collapse" id="collapse-${load_unlisted_nft_image_check}">
                               <input type="number" class="amount-${unlisted_creator_id} form-control nft_list_amount switch_theme border-rounded
         text-white" id="${load_entire_collection_array_row[i].list_array[index_search].image}" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01">
                               </div>
                             </div></div></div>
                  
                  `
                  load_unlisted_nft_check= load_unlisted_nft_check +load_search_collection_nft
                  }
                    load_search_collection_bottom = `
                     </div>
                     </div>
                     <div class="row">
                        <div class="col-6 col-xs-4  d-none me-auto">
                    <span class="text-white"> Set Bulk Price: </span><input data-id="${unlisted_creator_id}" type="number" class="form-control switch_theme border-rounded
         text-white bulk_amount" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01"> 
         </div>
         <div class="col-6 col-xs-4 me-auto text-start">
         <span class="text-white pe-2">
         Action:
         
         </span>
         <div class="d-flex justify-content-start">
                    <div class="btn btn-outline-dark border-rounded btn-padding me-2 switch_theme">Reset</div>
                    <div class="btn btn-dark border-rounded btn-padding me-2 switch_theme batch_list_all_nfts">List</div>
                     <div class="btn btn-dark border-rounded btn-padding me-2 d-none switch_theme batch_list_all_nfts">Bulk Amount</div>
                    </div>
                     </div>
                    </div>
                      </div>
                    `
                    
                $(".unlisted_nfts").append(load_search_collection_top+load_unlisted_nft_check+load_search_collection_bottom)
            mode_selected_function();
             }
             
            //  $("#pagination_unlisted").whjPaging("setPage", {
            //   currPage: currPage,
            //   totalPage: Math.ceil(load_entire_collection_array.length / 10),
            //   totalSize: pageSize,
            // });
         }
         
         //Listed_nfts
         async function load_entire_listed_collection_array_function(search_listed_results){
            load_listed_entire_collection_array = []
             for (var i=0; i < search_listed_results.length; i++) {
                       if(search_listed_results[i].contract_id == "x.paras.near"){
                           collection_found = search_listed_results[i].collection
                       }else{
                    // const response_collection_name = await fetch(`https://api-v2-mainnet.paras.id/collections?collection_id=${search_listed_results[i].contract_id}`);
                    // const response_data_name = await response_collection_name.json();
                    // collection_found = response_data_name.data.results[0].collection
                           collection_found = search_listed_results[i].contract_id
                       }
                       listed_nft_obj_array = {
                               collection:collection_found,
                               list_array:[search_listed_results[i]],
                               no_nfts:1
                           }
                        const index = load_listed_entire_collection_array.findIndex(object => {
                            return object.collection === collection_found;
                            });
                            if(index !== -1){
                                load_listed_entire_collection_array[index] = {
                                    collection:collection_found,
                               list_array:[...load_listed_entire_collection_array[index].list_array, ...[search_listed_results[i]]],
                                no_nfts:[...load_listed_entire_collection_array[index].list_array, ...[search_listed_results[i]]].length
                                    
                                }
                            }else{
                               load_listed_entire_collection_array.push(listed_nft_obj_array) 
                            }
                           
                   }
                   load_listed_entire_collection_array.sort((a, b) => parseFloat(b.no_nfts) - parseFloat(a.no_nfts));
                   load_listed_collection_into_html(load_listed_entire_collection_array,1,10)
         }
         async function load_listed_collection_into_html(load_listed_entire_collection_array,currPage, pageSize){
           $(".listed_nfts").html("")
           start_array = (currPage - 1) * pageSize;
           end = currPage * pageSize;
          load_listed_entire_collection_array_row = load_listed_entire_collection_array
            console.log(load_listed_entire_collection_array_row)
             for (var i=0; load_listed_entire_collection_array_row.length; i++) {
                   if(load_listed_entire_collection_array_row[i].list_array[0].metadata.collection_id){
                 collection_id = load_listed_entire_collection_array_row[i].list_array[0].metadata.collection_id
             }else{
                 collection_id = load_listed_entire_collection_array_row[i].list_array[0].metadata.creator_id
             }
             const response_collection = await fetch(`https://api-v2-mainnet.paras.id/collection-stats?collection_id=${collection_id}`);
            const response_data = await response_collection.json();
                    listed_image_url = load_listed_entire_collection_array_row[i].list_array[0].image
             listed_collection= load_listed_entire_collection_array_row[i].collection
             listed_creator_id= load_listed_entire_collection_array_row[i].list_array[0].metadata.creator_id
             listed_collection_array_count = load_listed_entire_collection_array_row[i].list_array.length
                   floor_price = response_data.data.results.floor_price / 1000000000000000000000000
                    load_search_collection_top = `
                    <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md">
                           <img src="${listed_image_url}" class="img-fluid border-rounded image_listed" style="height:auto; width:100%; object-fit: cover;">
                            </div>
                            <div class="col-xs-12 col-md-9">
                            <h5 class="text-white mt-2">${listed_collection}</>
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg">
                                  <p class="mb-0  text-white">Nfts:</p>
                                     <h5 class="mb-0  text-white">${listed_collection_array_count}</h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Floor Price:</p>
                                     <h5 class="mb-0  text-white">${floor_price.toFixed(2)}  </h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Total Fp:</p>
                                     <h5 class="mb-0  text-white">${(listed_collection_array_count*floor_price).toFixed(2)}   </h5>
                                  </div>
                                  </div>
                               </div>
                              
                            </div>
                             <div class="col-xs-12 col-md" >
                               <button data-toggle="collapse" data-target="#collapse-${listed_creator_id}" aria-expanded="false" aria-controls="collapse-${listed_creator_id}" class="btn btn-lg mt-xs-3 btn-dark border-rounded btn_switch btn-padding me-2 switch_theme w-100 mat_top">Show Nfts</button>
                               </div>
                            </div>
                             
                        </div>
                  <div class="collapse" id="collapse-${listed_creator_id}">
                    <div class="card card-body switch_theme p-2 mt-2">
                    <div class="row">
                  `
                  list_collection_array = load_listed_entire_collection_array_row[i].list_array
                  load_listed_nft_check = ""
                  for (var index_search=0; index_search < list_collection_array.length; index_search++) {
                      load_listed_nft_image_check= load_listed_entire_collection_array_row[i].list_array[index_search].image
                      var royalty_array = Object.values(load_listed_entire_collection_array_row[i].list_array[index_search].royalty);
                      load_listed_nft_royalty = 0 
                      for(obj_royalty in royalty_array){
                          if(obj_royalty!="sum"){
                          load_listed_nft_royalty = load_listed_nft_royalty+ parseFloat(royalty_array[obj_royalty]) 
                          }
                      }
                      listed_price = parseFloat(load_listed_entire_collection_array_row[i].list_array[index_search].price) / 1000000000000000000000000
                      load_search_collection_nft = await  `
                    <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card " style="text-decoration: none;"
                             >
                             <div class="card switch_theme " >
                              <img class="card-img-top img-fluid select_list_batch" 
                              data-contract_id="${load_listed_entire_collection_array_row[i].list_array[index_search].contract_id}" data-token_id="${load_listed_entire_collection_array_row[i].list_array[index_search].token_id}" 
                              data-image_url="${load_listed_entire_collection_array_row[i].list_array[index_search].image}"
                              data-royalty="${load_listed_nft_royalty}"
                              data-toggle="collapse" data-target="#collapse-${load_listed_nft_image_check}" aria-expanded="false" aria-controls="collapse-${load_listed_nft_image_check}"  src="${load_listed_entire_collection_array_row[i].list_array[index_search].image}" style="width:100% ; height: 100px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2 ">
                                 <h5 class="card-title text-white">${load_listed_entire_collection_array_row[i].list_array[index_search].metadata.title}</h5>
                                 <p class="text-white" style="font-size: 0.75rem;">Listed for ${(listed_price).toFixed(2)} </p>
                               
                               <div class="collapse" id="collapse-${load_listed_nft_image_check}">
                               <input type="number" class="amount-${listed_creator_id} form-control nft_list_amount switch_theme border-rounded
         text-white" id="${load_listed_entire_collection_array_row[i].list_array[index_search].image}" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01">
                               </div>
                             </div></div></div>
                  
                  `
                  load_listed_nft_check= load_listed_nft_check +load_search_collection_nft
                  }
                    load_search_collection_bottom = `
                     </div>
                     </div>
                     <div class="row">
                        <div class="col-6 col-xs-4  d-none me-auto">
                    <span class="text-white"> Set Bulk Price: </span><input data-id="${listed_creator_id}" type="number" class="form-control switch_theme border-rounded
         text-white bulk_amount" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01"> 
         </div>
         <div class="col-6 col-xs-4 me-auto text-start">
         <span class="text-white pe-2">
         Action:
         
         </span>
         <div class="d-flex justify-content-start">
                    <div class="btn btn-outline-dark border-rounded btn-padding me-2 switch_theme">Reset</div>
                    <div class="btn btn-dark border-rounded btn-padding me-2 switch_theme batch_list_all_nfts">Update</div>
                     <div class="btn btn-danger border-rounded btn-padding me-2 switch_theme batch_cancel_nft_btn">Cancel</div>
                    </div>
                     </div>
                    </div>
                      </div>
                    `
                    
                $(".listed_nfts").append(load_search_collection_top+load_listed_nft_check+load_search_collection_bottom)
            mode_selected_function();
             }
             
            //  $("#pagination_unlisted").whjPaging("setPage", {
            //   currPage: currPage,
            //   totalPage: Math.ceil(load_entire_collection_array.length / 10),
            //   totalSize: pageSize,
            // });
         }
         nft_list_obj_array= []
                   $(document).on("click", ".select_list_batch", function (e) {
            $(this).addClass("border-selected");
            token_id = $(this).data("token_id");
            contract_id = $(this).data("contract_id");
            image_url = $(this).data("image_url");
            royalty =  $(this).data("royalty");
            nft_list_obj = {
               contract_id: contract_id,
               token_id: token_id,
               image_url: image_url,
               amount:0,
               royalty:royalty
            };
            if (!nft_list_obj_array.some((nft_obj) => nft_obj.image_url === image_url)) {
               nft_list_obj_array.push(nft_list_obj);
            } else {
               nft_list_obj_array = nft_list_obj_array.filter((nft_obj) => nft_obj.image_url !== image_url);
               $(this).removeClass("border-selected");
            }
          
            if (nft_list_obj_array.length == 1) {
              batch_nft_list_amount = `You're about to list 1 NFT`;
            } else {
              batch_nft_list_amount = `You're about to List ${nft_list_obj_array.length} NFTs`;
            }
            $(".batch_nft_list_amount").html(batch_nft_list_amount);
         });
         
         
         //              $(document).on("keyup", ".bulk_amount", function (e) {
         //                 contract_id = $(this).data("id")
          
         //                 // var numItems = $(".amount-"+contract_id).length
         //               add_amount = $('div.unlisted_nfts').closest("#collapse-"+contract_id)
         //                   $(".amount-"+contract_id).on( "click", function() {
                    
         //                 });
         //                 console.log( add_amount);
         // $( ".amount-"+contract_id ).trigger( "click" );
         //                 add_amount.attr('value',$(this).val())
         //                 // alert($("#friendlyturtles.nearocean.near_588").val())
                
         //              })
         $(document).on("click", ".mat_top", function (e) {
         nft_list_obj_array = []
         })
             
                          $(document).on("keyup", ".nft_list_amount", function (e) {
                image_url = $(this).attr("id")
                objIndex = nft_list_obj_array.findIndex((obj => obj.image_url == image_url));
                    //Update object's name property.
                nft_list_obj_array[objIndex].amount = $(this).val()
             })
               $(document).on("click", ".batch_list_all_nfts", function (e) {
                   batch_nft_list_recieve = 0 
                   batch_royalty = nft_list_obj_array[0].royalty
                   for(obj_in in nft_list_obj_array){
                       if(obj_in != "sum"){
                      batch_nft_list_recieve = batch_nft_list_recieve + parseFloat(nft_list_obj_array[obj_in].amount)
                       }
                   }
                   $(".batch_nft_list_royalty").html(`Royalty: ${batch_nft_list_recieve * batch_royalty/10000} `)
                   $(".batch_nft_list_fee").html(`Marketplace Fee: ${batch_nft_list_recieve*0.02} `)
                   $(".batch_nft_list_recieve").html(`You'll receive ${batch_nft_list_recieve-(batch_nft_list_recieve * batch_royalty/10000) - batch_nft_list_recieve*0.02} `)
                   
                   $("#batch_nft_list").modal("show")
               })
               $(document).on("click", ".batch_list_nft_btn", function (e) {
                   batch_type = $(this).data("type")
                   batchListTransactions(batch_type)
               })
                 $(document).on("click", ".batch_cancel_nft_btn", function (e) {
                  batchCancelTransactions()
               })
               
               async function batchListTransactions(batch_type) {
         const account = await near.account(account_id);
            const keypair = await new nearApi.keyStores.BrowserLocalStorageKeyStore().getKey("mainnet", account_id);
            publicKey = keypair.publicKey;
            const publicKey_string = publicKey.toString();
            const { nonce, block_hash } = await near.connection.provider.query({
               request_type: "view_access_key",
               account_id: account_id,
               public_key: publicKey_string,
               finality: "optimistic",
            });
            action_array = []
            if(batch_type=="list"){
                batch_type_amount = nearApi.utils.format.parseNearAmount("0.0008")
            }else{
                batch_type_amount = String(1)
            }
            nft_list_obj_array.forEach(function (nft) {
                action_send = nearApi.transactions.functionCall(
                        "nft_approve",
                        {
                           account_id: "marketplace.paras.near",
                           token_id: String(nft.token_id),
                           msg: `{\"price\":\"${nearApi.utils.format.parseNearAmount(nft.amount)}\",\"market_type\":\"sale\",\"ft_token_id\":\"near\"}`,
                        },
                        27000000000000,
                        batch_type_amount
                     )
                  action_array.push(action_send)
            });
            console.log()
               var transaction_offer_send = new nearApi.transactions.Transaction({
                  signerId: account_id,
                  publicKey: publicKey,
                  nonce: nonce + 1,
                  receiverId: nft_list_obj_array[0].contract_id,
                  blockHash: bs58.decode(block_hash),
                  actions: action_array,
               });
         
               nft_offer_obj_array_transaction.push(transaction_offer_send);
           
         
            if (confirm_access) {
               const result_1 = await wallet.requestSignTransactions({
                  transactions: nft_offer_obj_array_transaction,
               });
            }
            console.log(result_1);
         }
         async function batchCancelTransactions() {
             nft_cancel_list_obj_array_transaction=[]
            const account = await near.account(account_id);
            const keypair = await new nearApi.keyStores.BrowserLocalStorageKeyStore().getKey("mainnet", account_id);
            publicKey = keypair.publicKey;
            const publicKey_string = publicKey.toString();
            const { nonce, block_hash } = await near.connection.provider.query({
               request_type: "view_access_key",
               account_id: account_id,
               public_key: publicKey_string,
               finality: "optimistic",
            });
            
            nft_list_obj_array.forEach(function (nft) {
                var delete_market_data = new nearApi.transactions.Transaction({
               signerId: account_id,
               publicKey: publicKey,
               nonce: nonce + 1,
               receiverId: "marketplace.paras.near",
               blockHash: bs58.decode(block_hash),
               actions: [
                  nearApi.transactions.functionCall(
                     "delete_market_data",
                     {
                        token_id: String(nft.token_id),
                        nft_contract_id: String(nft.contract_id)
                     },
                     27000000000000,
                     "1"
                  ),
               ],
            });
            nft_cancel_list_obj_array_transaction.push(delete_market_data);
               var transaction_list_send = new nearApi.transactions.Transaction({
                  signerId: account_id,
                  publicKey: publicKey,
                  nonce: nonce + 1,
                  receiverId: nft.contract_id,
                  blockHash: bs58.decode(block_hash),
                  actions: [
                     nearApi.transactions.functionCall(
                        "nft_revoke",
                        {
                           token_id: String(nft.token_id),
                           account_id: "marketplace.paras.near",
                        },
                        27000000000000,
                        "1"
                     ),
                  ],
               });
         
               nft_cancel_list_obj_array_transaction.push(transaction_list_send);
            });
         
            if (confirm_access) {
               const result_1 = await wallet.requestSignTransactions({
                  transactions: nft_cancel_list_obj_array_transaction,
               });
            }else{
                toastr.warning("No NkT card detected!");
            }
            console.log(result_1);
         }
         
         $(document).on("click",".select_gallery_theme", function(){
             select_gallery_theme_val = $(this).val()
             select_gallery_theme(select_gallery_theme_val)
         })
         async function select_gallery_theme(select_gallery_theme_val) {
            try {
               const contract = await new nearApi.Contract(wallet.account(), "theme.nearkits.near", {
                  changeMethods: ["set_theme"],
               });
               const formattedParams = {
                  message: select_gallery_theme_val
               };
         
               const ret = await contract.set_theme(formattedParams, 270000000000000);
            } catch (error) {
                console.log(error)
            }
         }
         get_gallery_theme() 
         async function get_gallery_theme() {
             account_id = wallet._authData.accountId;
            try {
                    $.ajax({
               url: "https://api-v2-mainnet.paras.id/token?owner_id=" + account_id + "&contract_id=cards.nearkits.near",
               method: "GET",
               dataType:"json",
               success: async function (responseData) {
                   if (responseData.data.results.length > 0) {
                      check_tier = responseData.data.results
                 const contract = await new nearApi.Contract(wallet.account(), "theme.nearkits.near", {
                  viewMethods: ["get_theme"],
               });
         
               const ret = await contract.get_theme({
                  account_id: account_id
               });
         
                for(ct in check_tier){
                    if(ct !== "sum"){
                    if(check_tier[ct].metadata.attributes[0].value == "Ruby"){
                         $(`.select_gallery_theme`).prop("disabled", false);
                    }
                    }
                }
                if(ret==null){
                   gallery_theme = "default"
               }else{
                     gallery_theme = ret
               }
               $(`.select_gallery_theme[value='${gallery_theme}']`).html("selected").prop("disabled", true);
            
               }
               }
            });
            } catch (error) {
                console.log(error)
            }
         }
           //Transaction history
         load_chart_data()
         function load_chart_data() {
                        chart_filter= "default"
         
                        $.ajax({
                            url: "https://nearkits.io/php/get_transaction_history.php",
                            type: "POST",
                            data: {
                                account_id: account_id
                            },
                            dataType: "json",
                            success: function(data) {
                                show_transaction_history = data.html
                               show_transaction_history_map= show_transaction_history.map(obj => {
         return {...obj, datetimeraw: new Date(obj.datetimeraw.date)};
         });
                                const show_transaction_history_sort = show_transaction_history_map.sort(
                                        (objA, objB) =>  Number(objB.datetimeraw)-Number(objA.datetimeraw),
                                    );
                                    console.log(show_transaction_history_map)
                                var view_date = [];
                                var page_view = [];
                                total_monthly_buys = 0
                                total_monthly_sales=0
                                $(".transaction_history_divs").html("")
                                transaction_month = String(show_transaction_history_sort[0].datetimeraw).substring(3, 7)
                                transaction_text_final = ``
                                for (var i in show_transaction_history_sort) {
                                    if(i !="sum"){
                                        datetimeraw = String(show_transaction_history_sort[i].datetimeraw)
                                    if(datetimeraw.substring(3, 7) === transaction_month){
                                        if(show_transaction_history_sort[i].type=="buy"){
                                            transaction_type=`<div class="btn btn-sm btn-success btn-padding p-1">Buy</div>`;
                                            total_monthly_buys = total_monthly_buys+ show_transaction_history_sort[i].price
                                        }else{
                                           transaction_type=`<div class="btn btn-sm btn-danger btn-padding p-1">Sales</div>`;
                                           total_monthly_sales =  total_monthly_sales+show_transaction_history_sort[i].price
                                        }
         
                                    transaction_text_final = transaction_text_final + `
                                    <div class="bg-gray-dark px-xl-4 rounded mt-3">
                    <div class="row">
                        <div class="col-6">
                      <p class="mb-1 text-white">${show_transaction_history_sort[i].contract_id}</p>
                      <p class="text-muted mb-0 text-white">${transaction_type}</p>
                    </div>
                    <div class="col-6 ">
                  <h6 class="mb-1 text-end text-white">${(show_transaction_history_sort[i].price).toFixed(2)+" "}</h6>
                      <p class="text-muted mb-0 text-end text-white">${String(show_transaction_history_sort[i].datetimeraw).substring(0,25)}</p>
                    </div>
                    </div>
                  </div>`
                                    }else{
                                        transaction_month_div= `<div class="bg-gray-dark px-xl-4 rounded mt-3">
                    <div class="row">
                        <div class="col-6">
                      <p class="mb-1 text-white">${transaction_month}</p>
                    </div>
                    <div class="col-6 ">
                  <p class="mb-1 text-end text-success">Total Buys: ${total_monthly_buys.toFixed(2)} </p>
                     <p class="mb-1 text-end text-danger">Total Sales: ${total_monthly_sales.toFixed(2)} </p>
                    </div>
                    </div>
                  </div>
                  <hrcclass="text-white">`
                  $(".transaction_history_divs").append(transaction_month_div+transaction_text_final)
                  mode_selected_function()
                                   transaction_text_final = ``
                                   transaction_month_div=''
                                   total_monthly_buys = 0
                                total_monthly_sales = 0
                                          transaction_month = datetimeraw.substring(3, 7)
                                    }
                                     view_date.push((show_transaction_history[i].datetimeraw));
                                    page_view.push(show_transaction_history_sort[i].price);
                                    }
         
                                }
                                let buys_array = show_transaction_history_sort.filter(e => e.type == "buy");
                                let sales_array = show_transaction_history_sort.filter(e => e.type == "sale");
                                total_buys = buys_array.sum("price");
                                total_sales = sales_array.sum("price");
                                $(".buys_total").html(total_buys+" ")
                                $(".sales_total").html(total_sales+" ")
         if ($("#transaction_history_chart").length) {
         var areaData = {
         labels: ["Sale", "Buys",],
         datasets: [{
            data: [total_sales, total_buys],
            backgroundColor: [
              "#111111","#00d25b"
            ]
          }
         ]
         };
         var areaOptions = {
         responsive: true,
         maintainAspectRatio: true,
         segmentShowStroke: false,
         cutoutPercentage: 70,
         elements: {
          arc: {
              borderWidth: 0
          }
         },      
         legend: {
          display: false
         },
         tooltips: {
          enabled: true
         }
         }
         var transactionhistoryChartPlugins = {
         beforeDraw: function(chart) {
          var width = chart.chart.width,
              height = chart.chart.height,
              ctx = chart.chart.ctx;
         
          ctx.restore();
          var fontSize = 1;
          ctx.font = fontSize + "rem sans-serif";
          ctx.textAlign = 'left';
          ctx.textBaseline = "middle";
          ctx.fillStyle = "#ffffff";
         
          var text = "$1200", 
              textX = Math.round((width - ctx.measureText(text).width) / 2),
              textY = height / 2.4;
         
          ctx.fillText(text, textX, textY);
         
          ctx.restore();
          var fontSize = 0.75;
          ctx.font = fontSize + "rem sans-serif";
          ctx.textAlign = 'left';
          ctx.textBaseline = "middle";
          ctx.fillStyle = "#6c7293";
         
          var texts = "Total", 
              textsX = Math.round((width - ctx.measureText(text).width) / 1.93),
              textsY = height / 1.7;
         
          ctx.fillText(texts, textsX, textsY);
          ctx.save();
         }
         }
         var transactionhistoryChartCanvas = $("#transaction_history_chart").get(0).getContext("2d");
         var transactionhistoryChart = new Chart(transactionhistoryChartCanvas, {
         type: 'doughnut',
         data: areaData,
         options: areaOptions,
         plugins: transactionhistoryChartPlugins
         });
         }
                      
                                
                                var ctx = $("#transaction_history");
                               if(chart_filter=="this_year"){
                                    var chartdata = {
                                    labels : ["Jan","Feb","Mar","Apr","May","June","July","Aug","Sept","Oct","Nov","Dec"],
                                    datasets: [{
                                        label: "page view",
                                        // fill: false,
                                        // lineTension: 0.1,
                                        backgroundColor: "rgba(38,218,210,0.3)",
                                        borderColor: "rgba(38,218,210,1)",
                                        pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
                                        pointHoverBorderColor: "rgba(59, 89, 152, 1)",
                                        borderWidth: 1,
                                        data: page_view
                                    }],
         
         
                                }
                                       window.LineGraph = new Chart(ctx, {
                                    type: 'line',
                                    data: chartdata,
                                    options: {   
                                    
                                        scales: {
                                            yAxes: [{
                                                ticks: {
                                                    beginAtZero: true,
                                                    userCallback: function(label, index, labels) {
                                                        // when the floored value is the same as the value we have a whole number
                                                        if (Math.floor(label) === label) {
                                                            return label;
                                                        }
         
                                                    },
                                                }
                                            }],
                                        }
                                            // downsample: {
                                            //  enabled: true,
                                            //      threshold: 10 ,
                                            //      preferOriginalData: false
                                            // }
                                    }
                                });
                               }else{
                                             var chartdata = {
                                    labels: view_date,
                                    datasets: [{
                                        label: "page view",
                                        // fill: false,
                                        // lineTension: 0.1,
                                        backgroundColor: "rgba(38,218,210,0.3)",
                                        borderColor: "rgba(38,218,210,1)",
                                        pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
                                        pointHoverBorderColor: "rgba(59, 89, 152, 1)",
                                        borderWidth: 1,
                                        data: page_view
                                    }],
         
         
                                }
                                window.LineGraph = new Chart(ctx, {
                                    
                                    type: 'line',
                                    data: chartdata,
                                    options: {   
                                    
                                        scales: {
                                            xAxes: [{
                                                type: 'time',
                                                time: {
                                                    unit: 'day'
                                                },
                                                 ticks: {
                                                   autoSkip: true,
                                                     maxTicksLimit: 7
                                                    },
                                                distribution: 'series'
                                            }],
                                            yAxes: [{
                                                ticks: {
                                                    beginAtZero: true,
                                                    userCallback: function(label, index, labels) {
                                                        // when the floored value is the same as the value we have a whole number
                                                        if (Math.floor(label) === label) {
                                                            return label;
                                                        }
         
                                                    },
                                                }
                                            }],
                                        }
                                            // downsample: {
                                            //  enabled: true,
                                            //      threshold: 10 ,
                                            //      preferOriginalData: false
                                            // }
                                    }
                                });
                               }
         
                            },
                            error: function(data) {
         
                            }
                        });
         
                    }
                    //Load most viewed products top 5
         //NFT sniperrrr
         
         $(".search_nft_snipe_form").submit(function (e) {
             e.preventDefault()
             $(".snipe_collection_stats").addClass("d-none")
             $(".floor_price_div").html()
            $("#load_snipe_collection").html(
               '<center><div class="row" style="height:400px;"><img class="col align-self-center" style="max-height:140px; max-width:140px; margin-left:auto; margin-right:auto;" src="https://nearkits.io/assets/images/loading_circle.svg"></div></center>'
            );
         
            search_snipe_collection_paras = $("#search_nft_snipe_collection").val();
            $.ajax({
               url: "https://api-v2-mainnet.paras.id/collections?collection_search=" + search_snipe_collection_paras,
               method: "GET",
               success: function (responseData) {
                  search_snipe_results_collections = responseData.data.results;
                  $("#load_snipe_collection").html("");
                  for (i in search_snipe_results_collections) {
                     if (i != "sum") {
                        if (search_snipe_results_collections[i].isCreator == true) {
                           load_badge = '<i class="mdi mdi-marker-check"></i>';
                        } else {
                           load_badge = "";
                        }
                        load_search_snipe_collection = `
                              <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card display_snipe_collection_info" style="text-decoration: none;" href="#display_snipe_collection_info"
                             data-collection_id="${search_snipe_results_collections[i].collection_id}"
                             >
                             <a  style="text-decoration: none;" href="#display_snipe_collection_info">
                             <div class="card switch_theme">
                              <img class="card-img-top img-fluid" src="https://paras-cdn.imgix.net/${search_snipe_results_collections[i].media}?w=800&auto=format,compress" style="width:100% ; height: 200px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2">
                                 <h5 class="card-title text-white">${search_snipe_results_collections[i].collection} ${load_badge}</h5>
                                 <div class="d-flex">
                                   <div class="preview-list w-100">
                                     <div class="preview-item p-0">
                                       <div class="preview-item-content d-flex flex-grow p-0">
                                         <div class="flex-grow">
                                           <div class="d-flex d-md-flex d-xl-flex justify-content-start">
                                           </div>
                                         </div>
                                       </div>
                                     </div>
                                   </div>
                                 </div>
                               
                             </div>
                             </a>
                           </div>
                             `;
                        $("#load_snipe_collection").append(load_search_snipe_collection);
                     }
                  }
               },
            });
         });
         snipe_contract_id = ""
         update_snipe_list = []
         total_card_sale = 0
         var now_timestamp = new Date();
         now_timestamp.setMinutes( now_timestamp.getMinutes() - 1);
         
         
         $(document).on("click", ".display_snipe_collection_info", async function () {
            snipe_collection_id = $(this).data("collection_id");
            $("#load_snipe_collection").html("");
            
            const response_collection_name = await fetch(`https://api-v2-mainnet.paras.id/collection-stats?collection_id=${snipe_collection_id}`);
            const response_data_name = await response_collection_name.json();
            snipe_total_owners = response_data_name.data.results.total_owners
            snipe_total_cards = response_data_name.data.results.total_cards
             total_card_sale = response_data_name.data.results.total_card_sale
            snipe_floor_price = response_data_name.data.results.floor_price/1000000000000000000000000
            snipe_contract_id = snipe_collection_id
            $("#snipe_total_owners").html(snipe_total_owners)
            $("#snipe_total_cards").html(snipe_total_cards)
            $("#snipe_floor_price").html(snipe_floor_price)
            $(".snipe_collection_stats").removeClass("d-none")
            setInterval(snipe_collection_update, 5000);
             $(".floor_price_div").html(` <div class="col-md-6">
                          <canvas id="listings_count_chart" style="width:100%; height:100%"></canvas>
                          </div>
                          <div class="col-md-6">
                          <canvas id="floorprice_count_chart"  style="width:100%; height:100%"></canvas>
                          </div>`)
            listings_count_chart_date=[(String(now_timestamp.getHours())+":"+String(now_timestamp.getMinutes()))] 
         listed_count =[total_card_sale]
         var ctx = $("#listings_count_chart");
         
                   var List_countChart = {
                labels: listings_count_chart_date,
                datasets: [{
                    label: "Listed",
                    // fill: false,
                    // lineTension: 0.1,
                    backgroundColor: "rgba(38,218,210,0.3)",
                    borderColor: "rgba(38,218,210,1)",
                    pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
                    pointHoverBorderColor: "rgba(59, 89, 152, 1)",
                    borderWidth: 1,
                    data: listed_count
                }],
         
         
            }
             window.List_countChart = new Chart(ctx, {
                
                type: 'line',
                data: List_countChart,
                options: {   
                
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                             ticks: {
                               autoSkip: true,
                                 maxTicksLimit: 7
                                },
                            distribution: 'series'
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                userCallback: function(label, index, labels) {
                                    // when the floored value is the same as the value we have a whole number
                                    if (Math.floor(label) === label) {
                                        return label;
                                    }
         
                                },
                            }
                        }],
                    }
                }
         
         
         
            });
             
              floor_price_chart_date=[(String(now_timestamp.getHours())+":"+String(now_timestamp.getMinutes()))] 
         floor_price =[snipe_floor_price]
         var ctx_floor = $("#floorprice_count_chart");
                   var floor_priceChart = {
                labels: floor_price_chart_date,
                datasets: [{
                    label: "Floor Price",
                    // fill: false,
                    // lineTension: 0.1,
                    backgroundColor: "rgba(38,218,210,0.3)",
                    borderColor: "rgba(38,218,210,1)",
                    pointHoverBackgroundColor: "rgba(59, 89, 152, 1)",
                    pointHoverBorderColor: "rgba(59, 89, 152, 1)",
                    borderWidth: 1,
                    data: floor_price
                }],
         
         
            }
             window.floor_priceChart = new Chart(ctx_floor, {
                
                type: 'line',
                data: floor_priceChart,
                options: {   
                
                    scales: {
                        xAxes: [{
                            type: 'time',
                            time: {
                                unit: 'day'
                            },
                             ticks: {
                               autoSkip: true,
                                 maxTicksLimit: 7
                                },
                            distribution: 'series'
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                userCallback: function(label, index, labels) {
                                    // when the floored value is the same as the value we have a whole number
                                    if (Math.floor(label) === label) {
                                        return label;
                                    }
         
                                },
                            }
                        }],
                    }
                }
         
         
         
            });
            setInterval(listed_count_update,5000)
         });
         
         
         
         async function snipe_collection_update(){
             contract_id = snipe_contract_id
            const response_listed = await fetch(`https://api-v2-mainnet.paras.id/activities?contract_id=${contract_id}&type=add_market_data&__limit=30`);
            const response_listed_data = await response_listed.json();
            newly_listed = response_listed_data.data.results
            console.log(update_snipe_list)
            try{
                if(update_snipe_list.length >0){
            const newly_listed_found = newly_listed.findIndex(object => {
                return object.msg.receipt_id === update_snipe_list[0].msg.receipt_id;
            });
            console.log(newly_listed)
            console.log(newly_listed_found)
            var filtered = newly_listed.filter(function(value, index, arr){ 
            return index < newly_listed_found;
            });
         
            update_snipe_list = [...filtered,...update_snipe_list]
            filtered_reverse = [...filtered].reverse();
            for(i in filtered_reverse){
                if(i !== "sum"){
            response_nft_snipe = await fetch(`https://api-v2-mainnet.paras.id/token?contract_id=${filtered_reverse[i].contract_id}&token_id=${filtered_reverse[i].token_id}`);
            response_nft_snipe = await response_nft_snipe.json();
            search_snipe_results = response_nft_snipe.data.results 
            load_snipe_search_collection = `
                              <div class="col-12 grid-margin stretch-card row" style="text-decoration: none;"
                             >
                             <div class="col-4 d-flex">
                          <img class="img-fluid border-rounded" src="${search_snipe_results[0].metadata.media}" style="width:50px ; height: 50px;
             object-fit: cover;" alt="">
             <div class="d-block">
             <h5 class="text-white pl-2">${search_snipe_results[0].metadata.title}</h5>
                    
                                </div>
                                </div>
                                <div class="col-4">
                                  <p class="text-white text-small">Price: ${(search_snipe_results[0].price / 1000000000000000000000000).toFixed(2)} </p>
                      <p class="text-white text-small">Rarity: ${search_snipe_results[0].metadata.score.toFixed(2)} </p>
                                </di>
                                </div>
                              <div class="col-4">
                                 
         
                                          <button  class="btn btn-sm d-block ms-auto border-rounded btn-dark snipe_nft_btn" 
                                          data-contract_id="${search_snipe_results[0].contract_id}"
                             data-token_id="${search_snipe_results[0].token_series_id}"
                             data-image_url="${search_snipe_results[0].metadata.media}"
                             data-price="${search_snipe_results[0].price}"
                              >Snipe</button>
                              </div>
                            
                          </div>
                             `;
                          $("#load_snipe_collection").prepend(load_snipe_search_collection).fadeIn('slow');
                }
            }
                }else{
         var filtered = newly_listed.filter(function(value, index, arr){ 
         check_timestamp = new Date(value.msg.datetime)
         return now_timestamp.getTime() < check_timestamp.getTime();
         });
         filtered_reverse = [...filtered].reverse();
         console.log(filtered)
         console.log(filtered_reverse)
         update_snipe_list= filtered
            for(i in filtered_reverse){
                if(i !== "sum"){
                    console.log(i)
            response_nft_snipe = await fetch(`https://api-v2-mainnet.paras.id/token?contract_id=${filtered_reverse[i].contract_id}&token_id=${filtered_reverse[i].token_id}`);
            response_nft_snipe = await response_nft_snipe.json();
            search_snipe_results = response_nft_snipe.data.results 
            console.log(search_snipe_results)
            load_snipe_search_collection = `
                              <div class="col-12 grid-margin stretch-card row" style="text-decoration: none;"
                             >
                             <div class="col-4 d-flex">
                          <img class="img-fluid border-rounded" src="${search_snipe_results[0].metadata.media}" style="width:50px ; height: 50px;
             object-fit: cover;" alt="">
             <div class="d-block">
             <h5 class="text-white pl-2">${search_snipe_results[0].metadata.title}</h5>
                    
                                </div>
                                </div>
                                <div class="col-4">
                                  <p class="text-white text-small">Price: ${(search_snipe_results[0].price / 1000000000000000000000000).toFixed(2)} </p>
                      <p class="text-white text-small">Rarity: ${search_snipe_results[0].metadata.score.toFixed(2)} </p>
                                </di>
                                </div>
                              <div class="col-4">
                                 
         
                                          <button  class="btn btn-sm d-block ms-auto border-rounded btn-dark snipe_nft_btn" data-contract_id="${search_snipe_results[0].contract_id}"
                             data-token_id="${search_snipe_results[0].token_series_id}"
                             data-image_url="${search_snipe_results[0].metadata.media}"
                             data-price="${search_snipe_results[0].price}"
                              >Snipe</button>
                              </div>
                            
                          </div>
                             `;
                          $("#load_snipe_collection").prepend(load_snipe_search_collection).fadeIn('slow');
                }
            }
            console.log(filtered_reverse)
                }
            }
            catch(error){
              console.log(error) 
            }
         }
         $(document).on("click",".snipe_nft_btn", async function(){
         snipe_contract_id= $(this).data("contract_id")
         snipe_token_id= $(this).data("token_id")
         snipe_price= $(this).data("price")
              try {
               const contract = await new nearApi.Contract(wallet.account(), "marketplace.paras.near", {
                  changeMethods: ["buy"],
               });
               const formattedParams = {
                  token_i: snipe_token_id,
                  nft_contract_id: snipe_contract_id,
                  ft_token_id: "near",
                  price: snipe_price
               };
         
               const ret = await contract.buy(formattedParams, 270000000000000, snipe_price);
            } catch (error) {
               console.log(error);
               toastr.warning("this nft can't be transferred");
            }
         })
           
                         function addData(chart, label, data) {
         chart.data.labels.push(label);
         chart.data.datasets.forEach((dataset) => {
         dataset.data.push(data);
         });
         chart.update();
         }
         
         async function listed_count_update(){
             snipe_collection_id = snipe_collection_id
             const response_collection_name = await fetch(`https://api-v2-mainnet.paras.id/collection-stats?collection_id=${snipe_collection_id}`);
            const response_data_name = await response_collection_name.json();
            snipe_total_owners = response_data_name.data.results.total_owners
            total_card_sale = response_data_name.data.results.total_card_sale
            snipe_total_cards = response_data_name.data.results.total_cards
            snipe_floor_price = response_data_name.data.results.floor_price/1000000000000000000000000
            snipe_contract_id = snipe_collection_id
            var new_timestamp = new Date();
             const snipe_floor_price_search = await fetch(`https://api-v2-mainnet.paras.id/token-series?contract_id=${snipe_collection_id}&__limit=1&__sort=lowest_price::1`);
            const snipe_floor_price_result = await snipe_floor_price_search.json();
           snipe_floor_price = snipe_floor_price_result.data.results[0].lowest_price/1000000000000000000000000
            addData(List_countChart, new_timestamp.getMinutes(), total_card_sale)
            addData(floor_priceChart, new_timestamp.getMinutes(), snipe_floor_price)
         }     
         
         //Whale Tracker
         search_whale_results_array = []
         $(".search_whale_account_form").on("submit", function (e) {
            e.preventDefault();
            account_id = $("#search_whale_account").val().toLowerCase();
            if (account_id.includes(".near") || account_id.length == 64) {
                load_entire_whale_collection(account_id)
                load_whale_transactions(account_id)
            } else {
               toastr.warning("Invalid account address!");
            }
         });
         
           function load_entire_whale_collection(account_id){
               $(".whale_buys").html(` <center>
                        <div class="vertical-center">
                           <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                              <div class="progress-bar" style="width: 10%; display: none;"></div>
                           </div>
                        </div>
                     </center>`)
               $(".whale_sales").html(` <center>
                        <div class="vertical-center">
                           <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                              <div class="progress-bar" style="width: 10%; display: none;"></div>
                           </div>
                        </div>
                     </center>`)
               $(".whale_nfts_held").html(` <center>
                        <div class="vertical-center">
                           <div class="progress mt-3 w-100" style="width: 200px; height: 8px; display: none;">
                              <div class="progress-bar" style="width: 10%; display: none;"></div>
                           </div>
                        </div>
                     </center>`)
            //  account_id = "thecryptoasian.near"
              $.ajax({
               url: "https://nearkits.io/php/get_nft_collection_array.php",
               method: "POST",
               data: {
                  account_id: account_id
               },
               dataType:"json",
               success: function (responseData) {
               
               $(".whale_nfts_held").html("")
                    search_whale_results_array = responseData.html
                    search_whale_results_array_unlisted = responseData.html
                    search_results_array = search_results_array.filter(data => data.has_price == null);
                    load_whale_entire_collection_array_function(search_whale_results_array)
               },
            });
         }
         
         async function load_whale_entire_collection_array_function(search_results_array){
            load_whale_entire_collection_array = []
             for (var i=0; i < search_whale_results_array.length; i++) {
                       if(search_whale_results_array[i].contract_id == "x.paras.near"){
                           whale_collection_found = search_whale_results_array[i].collection
                       }else{
                           whale_collection_found = search_whale_results_array[i].contract_id
                       }
                       whale_nft_obj_array = {
                               collection:whale_collection_found,
                               list_array:[search_whale_results_array[i]],
                               no_nfts:1
                           }
                        const index = load_whale_entire_collection_array.findIndex(object => {
                            return object.collection === whale_collection_found;
                            });
                            if(index !== -1){
                                load_whale_entire_collection_array[index] = {
                                    collection:whale_collection_found,
                               list_array:[...load_whale_entire_collection_array[index].list_array, ...[search_whale_results_array[i]]],
                                no_nfts:[...load_whale_entire_collection_array[index].list_array, ...[search_whale_results_array[i]]].length
                                    
                                }
                            }else{
                               load_whale_entire_collection_array.push(whale_nft_obj_array) 
                            }
                           
                   }
                   load_whale_entire_collection_array.sort((a, b) => parseFloat(b.no_nfts) - parseFloat(a.no_nfts));
                   load_whale_collection_into_html(load_whale_entire_collection_array,1,10)
         }
         
            async function load_whale_collection_into_html(load_whale_entire_collection_array,currPage, pageSize){
           start_array = (currPage - 1) * pageSize;
           end = currPage * pageSize;
          load_whale_entire_collection_array_row = load_whale_entire_collection_array
             for (var i=0; load_whale_entire_collection_array_row.length; i++) {
                   if(load_whale_entire_collection_array_row[i].list_array[0].metadata.collection_id){
                 whale_collection_id = load_whale_entire_collection_array_row[i].list_array[0].metadata.collection_id
             }else{
                 whale_collection_id = load_whale_entire_collection_array_row[i].list_array[0].metadata.creator_id
             }
             const response_collection = await fetch(`https://api-v2-mainnet.paras.id/collection-stats?collection_id=${whale_collection_id}`);
            const response_data = await response_collection.json();
            const response_near = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=NEAR&vs_currencies=USD`);
            response_near_usd = await response_near.json();
            response_near_usd =response_near_usd.near.usd
                    whale_image_url = load_whale_entire_collection_array_row[i].list_array[0].image
             whale_collection= load_whale_entire_collection_array_row[i].collection
             whale_creator_id= load_whale_entire_collection_array_row[i].list_array[0].metadata.creator_id
             whale_collection_array_count = load_whale_entire_collection_array_row[i].list_array.length
                   floor_price = response_data.data.results.floor_price / 1000000000000000000000000
                    load_search_collection_top = `
                    <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md">
                           <img src="${whale_image_url}" class="img-fluid border-rounded image_listed" style="height:auto; width:100%; object-fit: cover;">
                            </div>
                            <div class="col-xs-12 col-md-9">
                            <h5 class="text-white mt-2">${whale_collection}</>
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg">
                                  <p class="mb-0  text-white">Nfts:</p>
                                     <h5 class="mb-0  text-white">${whale_collection_array_count}</h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Floor Price:</p>
                                     <h5 class="mb-0  text-white">${floor_price.toFixed(2)}  </h5>
                                  </div>
                                  </div>
                                  <div class="col">
                                  <div class="border-rounded p-2 theme-dark-bg col">
                                  <p class="mb-0  text-white">Total Fp:</p>
                                     <h5 class="mb-0  text-white">${(whale_collection_array_count*floor_price).toFixed(2)}   </h5>
                                  </div>
                                  </div>
                               </div>
                              
                            </div>
                             <div class="col-xs-12 col-md" >
                               <button data-toggle="collapse" data-target="#collapse-${whale_creator_id}" aria-expanded="false" aria-controls="collapse-${whale_creator_id}" class="btn btn-lg mt-xs-3 btn-dark border-rounded btn_switch btn-padding me-2 switch_theme w-100 mat_top">Show Nfts</button>
                               </div>
                            </div>
                             
                        </div>
                  <div class="collapse" id="collapse-${whale_creator_id}">
                    <div class="card card-body switch_theme p-2 mt-2">
                    <div class="row">
                  `
                  list_collection_array = load_whale_entire_collection_array_row[i].list_array
                  load_whale_nft_check = ""
                  for (var index_search=0; index_search < list_collection_array.length; index_search++) {
                      load_whale_nft_image_check= load_whale_entire_collection_array_row[i].list_array[index_search].image
                      var royalty_array = Object.values(load_whale_entire_collection_array_row[i].list_array[index_search].royalty);
                      load_whale_nft_royalty = 0 
                      for(obj_royalty in royalty_array){
                          if(obj_royalty!="sum"){
                          load_whale_nft_royalty = load_whale_nft_royalty+ parseFloat(royalty_array[obj_royalty]) 
                          }
                      }
                      load_search_collection_nft = await  `
                    <div class="col-6 col-sm-4 col-md-3 col-lg-3 col-xl-2 grid-margin stretch-card " style="text-decoration: none;"
                             >
                             <div class="card switch_theme display_nft_info"  data-contract_id="${load_whale_entire_collection_array_row[i].list_array[index_search].contract_id}" data-token_id="${load_whale_entire_collection_array_row[i].list_array[index_search].token_id}" 
                              data-image="${load_whale_entire_collection_array_row[i].list_array[index_search].image}"
                             data-title="${load_whale_entire_collection_array_row[i].list_array[index_search].metadata.title}"
                             data-floor_price="${(floor_price).toFixed(2)} "
                             data-floor_price_usd="$ ${(floor_price*response_near_usd).toFixed(2)}"
                             data-score="Rarity: ${load_whale_entire_collection_array_row[i].list_array[index_search].metadata.score}"
                             data-collection="${load_whale_entire_collection_array_row[i].list_array[index_search].metadata.collection}"
                             data-title_nft="${load_whale_entire_collection_array_row[i].list_array[index_search].metadata.title}"
                             data-staked_link=""
                             data-type="get_nfts"
                              >
                              <img class="card-img-top img-fluid " 
                             
                              src="${load_whale_entire_collection_array_row[i].list_array[index_search].image}" style="width:100% ; height: 100px;
             object-fit: cover;" alt="">
             
                               <div class="card-body p-2 ">
                                 <h5 class="card-title text-white">${load_whale_entire_collection_array_row[i].list_array[index_search].metadata.title}</h5>
                               
                               <div class="collapse" id="collapse-${load_whale_nft_image_check}">
                               <input type="number" class="amount-${whale_creator_id} form-control nft_list_amount switch_theme border-rounded
         text-white" id="${load_whale_entire_collection_array_row[i].list_array[index_search].image}" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01">
                               </div>
                             </div></div></div>
                  
                  `
                  load_whale_nft_check= load_whale_nft_check +load_search_collection_nft
                  }
                    load_search_collection_bottom = `
                     </div>
                     </div>
                     <div class="row">
                        <div class="col-6 col-xs-4  d-none me-auto">
                    <span class="text-white"> Set Bulk Price: </span><input data-id="${whale_creator_id}" type="number" class="form-control switch_theme border-rounded
         text-white bulk_amount" aria-describedby="transfer_help" placeholder="Enter Amount" required="" step=".01"> 
         </div>
         <div class="col-6 col-xs-4 me-auto text-start">
         <span class="text-white pe-2">
         Action:
         
         </span>
         <div class="d-flex justify-content-start">
                    <div class="btn btn-outline-dark border-rounded btn-padding me-2 switch_theme">Reset</div>
                    <div class="btn btn-dark border-rounded btn-padding me-2 switch_theme batch_list_all_nfts">List</div>
                     <div class="btn btn-dark border-rounded btn-padding me-2 d-none switch_theme batch_list_all_nfts">Bulk Amount</div>
                    </div>
                     </div>
                    </div>
                      </div>
                    `
                    
                $(".whale_nfts_held").append(load_search_collection_top+load_whale_nft_check+load_search_collection_bottom)
            mode_selected_function();
             }
         }
         async function load_whale_transactions(account_id){
            $(".whale_buys").html("")
               $(".whale_sales").html("")
                $.ajax({
                            url: "https://nearkits.io/php/get_whale_transaction.php",
                            type: "POST",
                            data: {
                                account_id: account_id
                            },
                            dataType: "json",
                            success: async function(data) {
                                show_whale_transaction_history = data.html
                                console.log(show_whale_transaction_history)
                                whale_buys = show_whale_transaction_history.slice(0, 10)
                                whale_sales = show_whale_transaction_history.slice(9, 19)
                                 $(".whale_search_info").removeClass("d-none")
                                for(buy_index in whale_buys){
                                    if(buy_index !== "sum"){
                                  response_whale_buy = await fetch(`https://api-v2-mainnet.paras.id/token?token_id=${whale_buys[buy_index].token_id}&contract_id=${whale_buys[buy_index].contract_id}`);
                                  response_whale_buy = await response_whale_buy.json();  
                                  console.log(buy_index)
                                    whale_buy_text = `
                                        <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md">
                           <img src="${response_whale_buy.data.results[0].metadata.media}" class="img-fluid border-rounded image_listed" style="height:70px; width:70px; object-fit: cover;">
                            </div>
                            <div class="col-xs-12 col-md-9">
                            <p class="text-white mt-2">${response_whale_buy.data.results[0].metadata.title}
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <p class="mb-0 text-white">Price:${(whale_buys[buy_index].price).toFixed(2)}</p>
                                  <p class="mb-0 text-white">${(whale_buys[buy_index].datetime)}</p>
                                  </div>
         
                               </div>
                              
                            </p></div>
                             
                        </div>
                                    `
                                    
                                    $(".whale_buys").append(whale_buy_text)
                                    }
                                }
                                for(sale_index in whale_sales){
                                    if(sale_index !== "sum"){
                                  response_whale_sale = await fetch(`https://api-v2-mainnet.paras.id/token?token_id=${whale_sales[sale_index].token_id}&contract_id=${whale_sales[sale_index].contract_id}`);
                                  response_whale_sale = await response_whale_sale.json();  
                                    whale_sale_text = `
                                        <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md">
                           <img src="${response_whale_sale.data.results[0].metadata.media}" class="img-fluid border-rounded image_listed" style="height:70px; width:70px; object-fit: cover;">
                            </div>
                            <div class="col-xs-12 col-md-9">
                            <p class="text-white mt-2">${response_whale_sale.data.results[0].metadata.title}
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <p class="mb-0 text-white">Price:${(whale_sales[sale_index].price).toFixed(2)}</p>
                                  <p class="mb-0 text-white">${(whale_sales[sale_index].datetime)}</p>
                                  </div>
         
                               </div>
                              
                            </p></div>
                             
                        </div>
                                    `
                                    
                                    $(".whale_sales").append(whale_sale_text)
                                    }
                                }
                                
                            }
                })
         }
         load_top_users()
                 async function load_top_users()
                 {
                      response_top_users = await fetch(`https://api-v2-mainnet.paras.id/activities/top-users?__skip=0&__limit=5`);
                      response_top_users = await response_top_users.json();  
                      top_buyers = response_top_users.data.buyers
                      top_sellers = response_top_users.data.buyers
                      for(ibx in top_buyers){
                          if(ibx !=="sum"){
                      top_buyers_text = `
                                        <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md-9">
                            <p class="text-white mt-2">
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <p class="mb-0 text-white">${top_buyers[ibx].account_id}</p>
                                  <p class="mb-0 text-white">${(top_buyers[ibx].total_sum/1000000000000000000000000).toFixed(2)} </p>
                                  </div>
         
                               </div>
                              
                            </p></div>
                             
                        </div>
                                    `
                                    
                                    $(".top_buyers").append(top_buyers_text)
                          }
                      }
                      for(ibe in top_sellers){
                          if(ibe !=="sum"){
                      top_sellers_text = `
                                        <div class="col-xs-12 mt-3">
                        <div class="row">
                            <div class="col-xs-12 col-md-9">
                            <p class="text-white mt-2">
                            <div class=" align-items-center align-self-start row mt-1">
                            <div class="col">
                                  <p class="mb-0 text-white">${top_sellers[ibe].account_id}</p>
                                  <p class="mb-0 text-white">${(top_buyers[ibe].total_sum/1000000000000000000000000).toFixed(2)} </p>
                                  </div>
         
                               </div>
                              
                            </p></div>
                             
                        </div>
                                    `
                                    
                                    $(".top_sellers").append(top_sellers_text)
                          }
                      }
                 }
      </script>
      <script></script>
      <!-- End custom js for this page -->
   </body>
</html>